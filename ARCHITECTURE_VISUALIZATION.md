# ç³»ç»Ÿæ¶æ„å¯è§†åŒ–

## ğŸ“ æ•´ä½“ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         HappyGames ç³»ç»Ÿ                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         å‰ç«¯ (Client)                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  1ï¸âƒ£ æ¸¸æˆå¤§å… (Lobby)              2ï¸âƒ£ æ¸¸æˆæˆ¿é—´ (GameRoom)       â”‚
â”‚  â”œâ”€ é€‰æ‹©æ¸¸æˆ                       â”œâ”€ å®æ—¶æ£‹ç›˜                  â”‚
â”‚  â”œâ”€ å¼€å§‹åŒ¹é…                       â”œâ”€ ç§»åŠ¨æŒ‡ä»¤                  â”‚
â”‚  â””â”€ ç­‰å¾…å¯¹æ‰‹                       â””â”€ æ¸¸æˆçŠ¶æ€                  â”‚
â”‚                                                                  â”‚
â”‚  3ï¸âƒ£ ä¸ªäººä¸­å¿ƒ (Profile)            4ï¸âƒ£ æ¸¸æˆç»“æœå¯¹è¯æ¡†           â”‚
â”‚  â”œâ”€ æ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯                   â”œâ”€ èƒœè´Ÿç»“æœ                  â”‚
â”‚  â”œâ”€ æ˜¾ç¤ºç§°å·ï¼ˆå¸¦é¢œè‰²ï¼‰             â”œâ”€ ç§°å·å˜åŒ–                  â”‚
â”‚  â”œâ”€ æ˜¾ç¤ºç­‰çº§åˆ†                     â”œâ”€ ç§¯åˆ†å˜åŒ– (+/-)           â”‚
â”‚  â””â”€ æ˜¾ç¤ºæˆ˜ç»©ç»Ÿè®¡                   â””â”€ å†æ¥ä¸€å±€å€’è®¡æ—¶            â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†•ï¸ Socket.IO
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         åç«¯ (Server)                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  ğŸ® æ¸¸æˆé€»è¾‘å±‚                   ğŸ“Š è®¡ç®—å¼•æ“                    â”‚
â”‚  â”œâ”€ ChineseChessTable.js         â”œâ”€ EloService.js             â”‚
â”‚  â”œâ”€ æ£‹ç›˜çŠ¶æ€ç®¡ç†                 â”‚  â”œâ”€ calculateK()           â”‚
â”‚  â”œâ”€ æ¸¸æˆè§„åˆ™éªŒè¯                 â”‚  â”œâ”€ calculateExpected()    â”‚
â”‚  â”œâ”€ èƒœè´Ÿåˆ¤å®š                     â”‚  â””â”€ calculateDelta()       â”‚
â”‚  â””â”€ handleWin()/handleLoss()     â”‚                            â”‚
â”‚                                 â”œâ”€ Grade.js                 â”‚
â”‚  ğŸ  æˆ¿é—´ç®¡ç†                      â”‚  â”œâ”€ updatePlayerTitles()  â”‚
â”‚  â”œâ”€ MatchPlayers.js             â”‚  â”œâ”€ getTitleByRank()      â”‚
â”‚  â”œâ”€ ç©å®¶åŠ å…¥/ç¦»å¼€                â”‚  â””â”€ 10çº§ç§°å·è¡¨            â”‚
â”‚  â”œâ”€ å‡†å¤‡çŠ¶æ€                     â”‚                            â”‚
â”‚  â””â”€ å†æ¥ä¸€å±€é€»è¾‘                 â””â”€ GameMeta.js             â”‚
â”‚                                    â””â”€ Mu Dynamicç®¡ç†         â”‚
â”‚  ğŸ” è®¤è¯å±‚                                                     â”‚
â”‚  â”œâ”€ userController.js                                         â”‚
â”‚  â””â”€ JWT TokenéªŒè¯                                             â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†•ï¸ MongoDB
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         æ•°æ®åº“ (MongoDB)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  ğŸ‘¤ User è¡¨              ğŸ® UserGameStats è¡¨                    â”‚
â”‚  â”œâ”€ username            â”œâ”€ userId                              â”‚
â”‚  â”œâ”€ email               â”œâ”€ gameType (chinesechess/gomoku/...)  â”‚
â”‚  â”œâ”€ avatar              â”œâ”€ rating â† ELOæ›´æ–°                   â”‚
â”‚  â””â”€ ...                 â”œâ”€ title â† Gradeæ›´æ–°                  â”‚
â”‚                         â”œâ”€ titleRank â† Gradeæ›´æ–°               â”‚
â”‚  ğŸ’° Wallet è¡¨           â”œâ”€ titleColor â† Gradeæ›´æ–°              â”‚
â”‚  â”œâ”€ happyBeans          â”œâ”€ gamesPlayed â† ELOæ›´æ–°              â”‚
â”‚  â”œâ”€ piBalance           â”œâ”€ wins â† ELOæ›´æ–°                     â”‚
â”‚  â””â”€ ...                 â”œâ”€ losses â† ELOæ›´æ–°                   â”‚
â”‚                         â”œâ”€ draws â† ELOæ›´æ–°                     â”‚
â”‚  ğŸ“‹ GameMeta è¡¨         â””â”€ lastPlayedAt â† ELOæ›´æ–°             â”‚
â”‚  â”œâ”€ gameType                                                   â”‚
â”‚  â”œâ”€ muDynamic (å½“å‰)     ğŸ“¦ GameRecord è¡¨                      â”‚
â”‚  â””â”€ pendingMuDynamic    â”œâ”€ å†å²å¯¹å±€è®°å½•                       â”‚
â”‚     (å¾…ç”Ÿæ•ˆ)            â””â”€ ...                                â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ æ¸¸æˆç»“æŸæ•°æ®æµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æ¸¸æˆç»“æŸè§¦å‘           â”‚
â”‚ (è¢«å°†å†›/è¶…æ—¶/è®¤è¾“/ç¦»çº¿)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  ChineseChessTable.handleWin()          â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚            â”‚            â”‚
      â–¼            â–¼            â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ELOè®¡ç®—  â”‚  â”‚ç§°å·æ›´æ–°  â”‚  â”‚æ¸¸è±†ç»“ç®—  â”‚
  â”‚(å¿…é¡»)   â”‚  â”‚(ä¸­æ–‡åª) â”‚  â”‚(åç»­)    â”‚
  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚            â”‚
       â–¼            â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ UserGameStats æ•°æ®åº“æ›´æ–°         â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ rating: 1600 â†’ 1606              â”‚
  â”‚ title: åˆå‡ºèŒ…åº â†’ ä¸¾ä¸–æ— åŒ        â”‚
  â”‚ titleRank: 1 â†’ 10                â”‚
  â”‚ titleColor: #000000 â†’ #FF6200    â”‚
  â”‚ gamesPlayed, wins, losses...    â”‚
  â”‚ lastPlayedAt: now                â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ å¹¿æ’­ game_ended äº‹ä»¶              â”‚
  â”‚ åŒ…å«ï¼šwinner, elo, title          â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ å‰ç«¯æ¥æ”¶å¹¶æ˜¾ç¤º                    â”‚
  â”‚ â”œâ”€ èƒœè´Ÿç»“æœ                      â”‚
  â”‚ â”œâ”€ ç§°å·å˜åŒ–                      â”‚
  â”‚ â”œâ”€ ç§¯åˆ†å˜åŒ– (+/-)               â”‚
  â”‚ â””â”€ å†æ¥ä¸€å±€å€’è®¡æ—¶                â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“± ç™»å½• & æ•°æ®åŒæ­¥æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç”¨æˆ·ç™»å½•é¡µé¢  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
        â”‚ è¾“å…¥ç”¨æˆ·å/å¯†ç æˆ– Pi ç™»å½•
        â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ POST /api/user/login        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚ éªŒè¯å‡­è¯
               â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Userè¡¨æŸ¥è¯¢       â”‚
        â”‚ éªŒè¯å¯†ç /token   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚ éªŒè¯æˆåŠŸ
                 â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ ç”Ÿæˆ JWT Token           â”‚
        â”‚ è¿”å› token + userId      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ å‰ç«¯å­˜å‚¨                        â”‚
   â”‚ localStorage.setItem('token')   â”‚
   â”‚ localStorage.setItem('userId')  â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ è·³è½¬åˆ°ä¸ªäººä¸­å¿ƒ/æ¸¸æˆå¤§å…         â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚ åŠ è½½ç”¨æˆ·ä¿¡æ¯
            â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ GET /api/user/profile?userId=xxx    â”‚
   â”‚ Header: Authorization: Bearer token â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚ åç«¯æŸ¥è¯¢æ•°æ®åº“
              â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ 1ï¸âƒ£ æŸ¥è¯¢ User è¡¨                   â”‚
   â”‚ 2ï¸âƒ£ æŸ¥è¯¢ UserGameStats è¡¨          â”‚
   â”‚    - æ‰€æœ‰æ¸¸æˆçš„ rating            â”‚
   â”‚    - æ‰€æœ‰æ¸¸æˆçš„ title             â”‚
   â”‚    - æ‰€æœ‰æ¸¸æˆçš„ titleColor        â”‚
   â”‚    - æ‰€æœ‰æ¸¸æˆçš„æˆ˜ç»©               â”‚
   â”‚ 3ï¸âƒ£ æŸ¥è¯¢ Wallet è¡¨                 â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚ ç»„è£…å“åº”æ•°æ®
              â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ è¿”å›å®Œæ•´ç”¨æˆ·ä¿¡æ¯ï¼ˆå«gameStatsï¼‰â”‚
   â”‚ {                              â”‚
   â”‚   _id, username, nickname,     â”‚
   â”‚   assets: {...},               â”‚
   â”‚   gameStats: {                 â”‚
   â”‚     chinesechess: {            â”‚
   â”‚       rating: 1606,            â”‚
   â”‚       title: 'ä¸¾ä¸–æ— åŒ',         â”‚
   â”‚       titleRank: 10,           â”‚
   â”‚       titleColor: '#FF6200',   â”‚
   â”‚       gamesPlayed: 45,         â”‚
   â”‚       ...                      â”‚
   â”‚     },                         â”‚
   â”‚     ...                        â”‚
   â”‚   }                            â”‚
   â”‚ }                              â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ å‰ç«¯æ¸²æŸ“ä¸ªäººä¸­å¿ƒ                â”‚
   â”‚ â”œâ”€ ç”¨æˆ·åŸºæœ¬ä¿¡æ¯                â”‚
   â”‚ â”œâ”€ ä¸­å›½è±¡æ£‹ç§°å·ï¼ˆå¸¦é¢œè‰²ï¼‰       â”‚
   â”‚ â”‚  style={{ color: titleColor }}
   â”‚ â”œâ”€ ä¸­å›½è±¡æ£‹ç­‰çº§åˆ†               â”‚
   â”‚ â””â”€ æˆ˜ç»©ç»Ÿè®¡                    â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Socket.IO äº‹ä»¶æµ

### æ¸¸æˆè¿›è¡Œä¸­

```
å‰ç«¯                              åç«¯
 â”‚                                â”‚
 â”œâ”€â”€â†’ chinesechess_move â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚ éªŒè¯ç§»åŠ¨
 â”‚      { move, timestamp }       â”‚ æ›´æ–°æ£‹ç›˜
 â”‚                                â”‚ æ£€æµ‹æ¸¸æˆç»“æŸï¼Ÿ
 â”‚â†â”€â”€â”€â”€ move â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ è¿”å›æ–°çŠ¶æ€
 â”‚      { board, turn, ... }      â”‚
 â”‚                                â”‚
 â”œâ”€â”€â†’ chinesechess_move â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚
 â”‚      ...                       â”‚
 â”‚â†â”€â”€â”€â”€ move â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚      ...                       â”‚
```

### æ¸¸æˆç»“æŸ

```
å‰ç«¯                              åç«¯
 â”‚                                â”‚
 â”‚ (æ£€æµ‹åˆ°ç»“æŸæ¡ä»¶ï¼Œæˆ–å¯¹æ‰‹ç¦»çº¿)      â”‚
 â”‚                                â”‚
 â”‚                            â”Œâ”€â”€â†’â”‚ è®¡ç®— ELO
 â”‚                            â”‚   â”‚ è®¡ç®— Grade
 â”‚                            â”‚   â”‚ ä¿å­˜æ•°æ®åº“
 â”‚                            â”‚   â”‚
 â”‚â†â”€ game_ended â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
 â”‚   {                            â”‚
 â”‚     result: {                  â”‚
 â”‚       winner: 'r',             â”‚
 â”‚       winnerId: 'xxx',         â”‚
 â”‚       elo: {...},              â”‚
 â”‚       title: {...}             â”‚
 â”‚     }                          â”‚
 â”‚   }                            â”‚
 â”‚                                â”‚
 â”‚ æ˜¾ç¤ºæ¸¸æˆç»“æœå¯¹è¯æ¡†               â”‚
 â”‚ æ›´æ–°æœ¬åœ°ç”¨æˆ·ä¿¡æ¯                 â”‚
```

### é‡æ–°åŒ¹é…

```
å‰ç«¯                              åç«¯
 â”‚                                â”‚
 â”‚ ç©å®¶ç‚¹å‡»"åŒæ„å†æ¥ä¸€å±€"           â”‚
 â”‚                                â”‚
 â”œâ”€â”€â†’ rematch_request â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚ è®°å½•åŒæ„
 â”‚                                â”‚
 â”‚â†â”€ rematch_update â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ å¹¿æ’­åŒæ„çŠ¶æ€
 â”‚   { agreedCount, totalPlayers }â”‚
 â”‚                                â”‚
 â”‚ (å¦ä¸€ç©å®¶ä¹ŸåŒæ„æ—¶)               â”‚
 â”‚                                â”‚
 â”‚â†â”€ players_ready â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ å¼€å§‹å€’è®¡æ—¶
 â”‚                                â”‚
 â”‚â†â”€ game_start â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ æ¸¸æˆå¼€å§‹
 â”‚   { board, turn, ... }         â”‚
```

---

## ğŸ“Š ELO è®¡ç®—æµç¨‹å›¾

```
                    â”Œâ”€ è·å–åŒæ–¹è¯„åˆ†
                    â”‚  ratingA, ratingB
                    â”‚
                    â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ è®¡ç®— K å€¼ï¼ˆåŠ¨æ€ï¼‰   â”‚
            â”‚ K = 4 + 36*f_r*f_gâ”‚
            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â–¼            â–¼            â–¼
  f_games       f_rating     K_final
  åŸºäºå±€æ•°      åŸºäºè¯„åˆ†      (å®é™…ç”¨äºè®¡ç®—)
  æ›´å¤šæ¯”èµ›â†’     å·®å¼‚å¤§â†’
  Kå€¼è¶Šå°       Kå€¼è¶Šå°
                
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ è®¡ç®—é¢„æœŸèƒœç‡        â”‚
            â”‚ E_A = 1/(1+10^X)   â”‚
            â”‚ X = (R_B-R_A)/400  â”‚
            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼                     â–¼
    èƒœè€…æœŸæœ›å€¼              è´Ÿè€…æœŸæœ›å€¼
    E_A â‰ˆ 0.7          E_B â‰ˆ 0.3
    (å¼ºè€…æ˜“èƒœ)          (å¼±è€…æ˜“è´Ÿ)
    
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ è®¡ç®—ç§¯åˆ†å˜åŒ–        â”‚
            â”‚ Î”R = K*(S-E)      â”‚
            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼                     â–¼
    èƒœè€…è·å¾—             è´Ÿè€…å¤±å»
    Î” = K*(1-E_A)      Î” = K*(0-E_B)
    = K * 0.3          = K * (-0.3)
    â‰ˆ +6åˆ†             â‰ˆ -5åˆ†
    
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ æ›´æ–°è¯„åˆ†            â”‚
            â”‚ R_A' = R_A + Î”R   â”‚
            â”‚ R_B' = R_B + Î”R   â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ Gradeï¼ˆç§°å·ï¼‰åˆ†é…æµç¨‹å›¾

```
ç©å®¶èµ¢å¾—æ¸¸æˆ
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è·å–è¯¥ç©å®¶çš„æ–°è¯„åˆ†        â”‚
â”‚ rating = 1606             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è®¡ç®—ç©å®¶æ’å                      â”‚
â”‚ betterPlayers = rating>1606çš„æ•° â”‚
â”‚ rank = betterPlayers + 1         â”‚
â”‚                                  â”‚
â”‚ ä¾‹ï¼š2ä¸ªç©å®¶è¯„åˆ†æ›´é«˜ â†’ rank = 3    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è·å–æ€»ç©å®¶æ•°                  â”‚
â”‚ totalPlayers = 100            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è®¡ç®—ç™¾åˆ†æ¯”æ’å              â”‚
â”‚ percentile = (rank-1)/totalâ”‚
â”‚ = (3-1)/100 = 2%           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æŸ¥è¡¨ï¼Œæ ¹æ®ç™¾åˆ†æ¯”åˆ†é…ç§°å·        â”‚
â”‚                                 â”‚
â”‚ ä»é«˜åˆ°ä½ï¼š                      â”‚
â”‚ 2% < 3% â†’ ç™»å³°é€ æ (rank 9)    â”‚
â”‚ (ç»§ç»­åŒ¹é…...)                   â”‚
â”‚ âœ“ ç¬¦åˆ â†’ ç™»å³°é€ æ               â”‚
â”‚     titleRank = 9               â”‚
â”‚     titleColor = #ffba08        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ›´æ–°æ•°æ®åº“                â”‚
â”‚ stats.title = 'ç™»å³°é€ æ'  â”‚
â”‚ stats.titleRank = 9      â”‚
â”‚ stats.titleColor = ...   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’¾ æ•°æ®æµå‘æ±‡æ€»

```
ç”¨æˆ·èµ¢å¾—æ¸¸æˆ
    â”‚
    â”œâ†’ ELO è®¡ç®— â”€â”€â†’ UserGameStats.rating â†‘
    â”‚               UserGameStats.wins â†‘
    â”‚               UserGameStats.lastPlayedAt = now
    â”‚
    â”œâ†’ Grade è®¡ç®— â”€â”€â†’ UserGameStats.title æ›´æ–°
    â”‚                UserGameStats.titleRank æ›´æ–°
    â”‚                UserGameStats.titleColor æ›´æ–°
    â”‚
    â”œâ†’ å¹¿æ’­ game_ended
    â”‚   { elo: {...}, title: {...} }
    â”‚
    â””â†’ å‰ç«¯æ˜¾ç¤ºç»“æœ
        â”œâ”€ æ›´æ–° UI
        â””â”€ localStorage å¯é€‰ä¿å­˜


ç”¨æˆ·ç™»å½•ä¸ªäººä¸­å¿ƒ
    â”‚
    â”œâ†’ GET /api/user/profile
    â”‚
    â”œâ†’ åç«¯æŸ¥è¯¢
    â”‚   Userè¡¨ + UserGameStatsè¡¨ + Walletè¡¨
    â”‚
    â””â†’ è¿”å›å®Œæ•´æ•°æ®ç»™å‰ç«¯
        â””â”€ gameStats åŒ…å«æ‰€æœ‰æ¸¸æˆæ•°æ®
            â”œâ”€ rating
            â”œâ”€ title
            â”œâ”€ titleColor
            â””â”€ æˆ˜ç»©ç»Ÿè®¡
```

---

è¿™å°±æ˜¯æ•´ä¸ªç³»ç»Ÿçš„å®Œæ•´æ¶æ„å¯è§†åŒ–ï¼ğŸ¨

