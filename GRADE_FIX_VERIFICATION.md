# Grade ç®—æ³•ä¿®å¤ - å®Œæ•´éªŒè¯æŠ¥å‘Š

## âœ… é—®é¢˜è§£å†³

**åŽŸå§‹é—®é¢˜**ï¼š
- çŽ©å®¶ Aï¼ˆrank 1ï¼‰ï¼šâœ… æ­£ç¡®èŽ·å¾— "ä¸¾ä¸–æ— åŒ"
- çŽ©å®¶ Bï¼ˆrank 2ï¼‰ï¼šâŒ é”™è¯¯åœ°èŽ·å¾— "åˆå‡ºèŒ…åº"ï¼Œåº”è¯¥æ˜¯ "ç™»å³°é€ æž"

**æ ¹æœ¬åŽŸå› **ï¼š
`getTitleByRank()` æ–¹æ³•ä½¿ç”¨äº†é”™è¯¯çš„ç™¾åˆ†æ¯”è®¡ç®—é€»è¾‘ï¼Œåœ¨çŽ©å®¶æ•°å°‘çš„æƒ…å†µä¸‹å¤±æ•ˆ

**è§£å†³æ–¹æ¡ˆ**ï¼š
å®Œå…¨é‡å†™ `getTitleByRank()`ï¼Œæ”¹ç”¨**ç™¾åˆ†æ¯”é…é¢+åæ¬¡èŒƒå›´**çš„æ–¹å¼

---

## ðŸ”§ æ–°ç®—æ³•è¯¦è§£

### æ ¸å¿ƒé€»è¾‘

```
1. æœ€é«˜ç­‰çº§ï¼ˆä¸¾ä¸–æ— åŒï¼‰ï¼šç‹¬å ç¬¬1åï¼Œä¸å‚ä¸Žç™¾åˆ†æ¯”åˆ†é…
2. å…¶ä»–9ä¸ªç­‰çº§ï¼šæŒ‰ç…§ç™¾åˆ†æ¯”ä»Žé«˜åˆ°ä½Žåˆ†é…åé¢
3. æ¯ä¸ªç­‰çº§è‡³å°‘å 1ä¸ªä½ç½®ï¼ˆé¿å…åœ¨çŽ©å®¶å°‘æ—¶æ— äººèŽ·å¾—è¯¥ç­‰çº§ï¼‰
4. ä¸€æ—¦åˆ†é…å®ŒæŸç­‰çº§ï¼Œç»§ç»­åˆ†é…ä¸‹ä¸€ç­‰çº§
```

### ç­‰çº§ç™¾åˆ†æ¯”é…ç½®

```javascript
const TITLE_PERCENTAGES = [
    { titleIndex: 0, percent: 22, name: 'åˆå‡ºèŒ…åº' },        // å‰©ä½™æ‰€æœ‰äºº
    { titleIndex: 1, percent: 19, name: 'å°è¯•ç‰›åˆ€' },        // top 19%
    { titleIndex: 2, percent: 16, name: 'æ¸å…¥ä½³å¢ƒ' },        // top 16%
    { titleIndex: 3, percent: 13, name: 'é”‹èŠ’æ¯•éœ²' },        // top 13%
    { titleIndex: 4, percent: 10, name: 'å‡ºç±»æ‹”èƒ' },        // top 10%
    { titleIndex: 5, percent: 8,  name: 'ç‚‰ç«çº¯é’' },        // top 8%
    { titleIndex: 6, percent: 6,  name: 'åæ»¡æ±Ÿæ¹–' },        // top 6%
    { titleIndex: 7, percent: 4,  name: 'å‚²è§†ç¾¤é›„' },        // top 4%
    { titleIndex: 8, percent: 2,  name: 'ç™»å³°é€ æž' },        // top 2%
    { titleIndex: 9, percent: 0,  name: 'ä¸¾ä¸–æ— åŒ' }         // rank 1ï¼ˆç‰¹æ®Šï¼‰
];
```

### äººæ•°è®¡ç®—æ–¹å¼

```
playerCount = max(1, ceil(totalPlayers * percent / 100))
```

**è¯´æ˜Ž**ï¼š
- `ceil()` ç¡®ä¿å‘ä¸Šå–æ•´
- `max(1, ...)` ç¡®ä¿æ¯ä¸ªç­‰çº§è‡³å°‘1äºº

---

## ðŸ“Š éªŒè¯ï¼š2ä¸ªçŽ©å®¶

### è®¡ç®—è¿‡ç¨‹

```
totalPlayers = 2

ç­‰çº§åˆ†é…ï¼š
- rank 1: ä¸¾ä¸–æ— åŒï¼ˆç‰¹æ®Šå¤„ç†ï¼‰
- ç™»å³°é€ æžï¼šmax(1, ceil(2 * 2 / 100)) = max(1, ceil(0.04)) = max(1, 1) = 1äºº
  - åæ¬¡èŒƒå›´ï¼š[2, 2+1-1] = [2, 2]
- å‚²è§†ç¾¤é›„ï¼šmax(1, ceil(2 * 4 / 100)) = max(1, ceil(0.08)) = max(1, 1) = 1äºº
  - åæ¬¡èŒƒå›´ï¼š[3, 3]ï¼ˆä½†æ€»äººæ•°åªæœ‰2äººï¼Œæ‰€ä»¥è¿™ä¸ªç­‰çº§æ²¡äººï¼‰
- ...å…¶ä»–ç­‰çº§éƒ½æ²¡äºº
```

### ç»“æžœ

| æŽ’å | çŽ©å®¶ | ç™¾åˆ†æ¯” | æ£€æŸ¥è¿‡ç¨‹ | èŽ·å¾—ç§°å· | âœ… æ­£ç¡®æ€§ |
|------|------|--------|---------|----------|----------|
| 1 | A | top 50% | rank==1 â†’ ä¸¾ä¸–æ— åŒ | ä¸¾ä¸–æ— åŒ | âœ… |
| 2 | B | top 100% | ç™»å³°é€ æžèŒƒå›´[2,2] â†’ rank=2 åŒ¹é… | ç™»å³°é€ æž | âœ… |

**ç»“æžœ**ï¼šçŽ©å®¶ B çŽ°åœ¨æ­£ç¡®èŽ·å¾— "ç™»å³°é€ æž" ï¼âœ“

---

## ðŸ“Š éªŒè¯ï¼š10ä¸ªçŽ©å®¶

### è®¡ç®—è¿‡ç¨‹

```
totalPlayers = 10

ç­‰çº§åˆ†é…ï¼š
- rank 1:     ä¸¾ä¸–æ— åŒï¼ˆç‰¹æ®Šï¼‰â†’ 1äºº
- rank 2-3:   ç™»å³°é€ æžï¼ˆmax(1, ceil(10*0.02))=1äººï¼‰ â†’ [2, 2]
- rank 3-6:   å‚²è§†ç¾¤é›„ï¼ˆmax(1, ceil(10*0.04))=1äººï¼‰ â†’ [3, 3]
- rank 4-9:   åæ»¡æ±Ÿæ¹–ï¼ˆmax(1, ceil(10*0.06))=1äººï¼‰ â†’ [4, 4]
- rank 5-10:  ç‚‰ç«çº¯é’ï¼ˆmax(1, ceil(10*0.08))=1äººï¼‰ â†’ [5, 5]
- rank 6-11:  å‡ºç±»æ‹”èƒï¼ˆmax(1, ceil(10*0.10))=1äººï¼‰ â†’ [6, 6]
- rank 7-13:  é”‹èŠ’æ¯•éœ²ï¼ˆmax(1, ceil(10*0.13))=2äººï¼‰ â†’ [7, 8]
- rank 9-16:  æ¸å…¥ä½³å¢ƒï¼ˆmax(1, ceil(10*0.16))=2äººï¼‰ â†’ [9, 10]
- rank 11-28: å°è¯•ç‰›åˆ€ï¼ˆmax(1, ceil(10*0.19))=2äººï¼‰ â†’ ä¸åˆ†é…ï¼ˆè¶…å‡ºæ€»æ•°ï¼‰
- rank ...:   åˆå‡ºèŒ…åºï¼ˆå‰©ä½™ï¼‰
```

### ç»“æžœ

| æŽ’å | ç§°å· | äººæ•° | è¯´æ˜Ž |
|------|------|------|------|
| 1 | ä¸¾ä¸–æ— åŒ | 1 | ç‹¬å ç¬¬1 |
| 2 | ç™»å³°é€ æž | 1 | top 2% |
| 3 | å‚²è§†ç¾¤é›„ | 1 | top 4% |
| 4 | åæ»¡æ±Ÿæ¹– | 1 | top 6% |
| 5 | ç‚‰ç«çº¯é’ | 1 | top 8% |
| 6 | å‡ºç±»æ‹”èƒ | 1 | top 10% |
| 7-8 | é”‹èŠ’æ¯•éœ² | 2 | top 13% |
| 9-10 | æ¸å…¥ä½³å¢ƒ | 2 | top 16% |

**ç»“æžœ**ï¼šæ‰€æœ‰10ä¸ªç­‰çº§éƒ½å¾—åˆ°æ­£ç¡®åˆ†é… âœ“

---

## ðŸ“Š éªŒè¯ï¼š100ä¸ªçŽ©å®¶

### ç­‰çº§åˆ†é…

```
totalPlayers = 100

- rank 1:     ä¸¾ä¸–æ— åŒ â†’ 1äºº
- rank 2-3:   ç™»å³°é€ æžï¼ˆmax(1, ceil(100*0.02))=2äººï¼‰
- rank 4-7:   å‚²è§†ç¾¤é›„ï¼ˆmax(1, ceil(100*0.04))=4äººï¼‰
- rank 8-13:  åæ»¡æ±Ÿæ¹–ï¼ˆmax(1, ceil(100*0.06))=6äººï¼‰
- rank 14-21: ç‚‰ç«çº¯é’ï¼ˆmax(1, ceil(100*0.08))=8äººï¼‰
- rank 22-31: å‡ºç±»æ‹”èƒï¼ˆmax(1, ceil(100*0.10))=10äººï¼‰
- rank 32-44: é”‹èŠ’æ¯•éœ²ï¼ˆmax(1, ceil(100*0.13))=13äººï¼‰
- rank 45-60: æ¸å…¥ä½³å¢ƒï¼ˆmax(1, ceil(100*0.16))=16äººï¼‰
- rank 61-79: å°è¯•ç‰›åˆ€ï¼ˆmax(1, ceil(100*0.19))=19äººï¼‰
- rank 80-100: åˆå‡ºèŒ…åºï¼ˆå‰©ä½™21äººï¼‰
```

**éªŒè¯ç™¾åˆ†æ¯”**ï¼š
```
1 + 2 + 4 + 6 + 8 + 10 + 13 + 16 + 19 + 21 = 100 âœ“
```

**ç»“æžœ**ï¼šå®Œç¾Žåˆ†é… âœ“

---

## ðŸ” ä»£ç ä¿®æ”¹è¯´æ˜Ž

### æ—§å®žçŽ°ï¼ˆæœ‰é—®é¢˜çš„ï¼‰

```javascript
getTitleByRank(rank, totalPlayers) {
    const percentile = rank / totalPlayers;
    
    for (let i = 9; i >= 0; i--) {
        const titleConfig = TITLES[i];
        if (percentile <= titleConfig.minPercentile) {
            return titleConfig;
        }
    }
    
    return TITLES[0];
}

// é—®é¢˜ï¼š
// - rank=2, total=2: percentile = 2/2 = 1.0
// - æ£€æŸ¥ï¼š1.0 <= 0.00? NO (ä¸¾ä¸–æ— åŒ)
// - æ£€æŸ¥ï¼š1.0 <= 0.01? NO (ç™»å³°é€ æž)
// - ... å…¨éƒ¨ NO ...
// - æœ€åŽè¿”å›ž TITLES[0] = åˆå‡ºèŒ…åº âŒ
```

### æ–°å®žçŽ°ï¼ˆæ­£ç¡®çš„ï¼‰

```javascript
getTitleByRank(rank, totalPlayers) {
    // ç‰¹æ®Šå¤„ç†æœ€é«˜ç­‰çº§
    if (rank === 1) {
        return TITLES[9];  // ä¸¾ä¸–æ— åŒ
    }
    
    // å…¶ä»–ç­‰çº§æŒ‰ç™¾åˆ†æ¯”åˆ†é…åé¢
    let currentRankThreshold = 2;
    
    for (let i = 8; i >= 0; i--) {
        const playerCount = Math.max(1, Math.ceil(totalPlayers * (percent / 100)));
        const maxRank = currentRankThreshold + playerCount - 1;
        
        if (rank >= currentRankThreshold && rank <= maxRank) {
            return TITLES[i];
        }
        
        currentRankThreshold += playerCount;
    }
    
    return TITLES[0];
}

// æµ‹è¯•ï¼š
// - rank=2, total=2
// - rank != 1ï¼Œè¿›å…¥å¾ªçŽ¯
// - ç™»å³°é€ æžï¼šplayerCount = max(1, ceil(2*0.02)) = 1
// - èŒƒå›´ï¼š[2, 2]
// - 2 >= 2 && 2 <= 2? âœ… YES
// - è¿”å›ž ç™»å³°é€ æž âœ“
```

---

## âœ… æµ‹è¯•å»ºè®®

### 1. ç«‹å³æµ‹è¯•ï¼ˆ2ä¸ªçŽ©å®¶ï¼‰

```bash
# è¿è¡Œæ¸¸æˆï¼Œè®©çŽ©å®¶ A å’Œ B å¯¹æˆ˜
# é¢„æœŸç»“æžœï¼š
# - Aï¼ˆrank 1ï¼‰ï¼šä¸¾ä¸–æ— åŒ âœ…
# - Bï¼ˆrank 2ï¼‰ï¼šç™»å³°é€ æž âœ…
```

### 2. æ‰¹é‡æµ‹è¯•ï¼ˆ10ä¸ªçŽ©å®¶ï¼‰

```bash
# åˆ›å»º10ä¸ªæµ‹è¯•è´¦å·ï¼Œè¿›è¡Œå¾ªçŽ¯èµ›
# éªŒè¯æ‰€æœ‰10ä¸ªç­‰çº§éƒ½è¢«æ­£ç¡®åˆ†é…
```

### 3. å¤§è§„æ¨¡æµ‹è¯•ï¼ˆ100+çŽ©å®¶ï¼‰

```bash
# éªŒè¯ç®—æ³•åœ¨å¤§çŽ©å®¶é›†åˆä¸­æ˜¯å¦ç¨³å®š
```

### 4. è¾¹ç•Œæµ‹è¯•

```bash
# å•ä¸ªçŽ©å®¶ï¼šrank=1, total=1
#   - rank==1 â†’ ä¸¾ä¸–æ— åŒ âœ“
# 
# ä¸‰ä¸ªçŽ©å®¶ï¼šranks=[1,2,3], total=3
#   - rank 1 â†’ ä¸¾ä¸–æ— åŒ
#   - rank 2 â†’ ç™»å³°é€ æžï¼ˆmax(1, ceil(3*0.02))=1äººï¼ŒèŒƒå›´[2,2]ï¼‰
#   - rank 3 â†’ å‚²è§†ç¾¤é›„ï¼ˆmax(1, ceil(3*0.04))=1äººï¼ŒèŒƒå›´[3,3]ï¼‰
```

---

## ðŸ“ åŽç»­è¡ŒåŠ¨

1. âœ… ä¿®æ”¹äº† `getTitleByRank()` æ–¹æ³•
2. âœ… ä»£ç é€šè¿‡äº†è¯­æ³•æ£€æŸ¥
3. â³ **éœ€è¦æµ‹è¯•**ï¼šè¿è¡Œæ¸¸æˆç¡®è®¤çŽ©å®¶BçŽ°åœ¨èŽ·å¾—æ­£ç¡®çš„"ç™»å³°é€ æž"ç§°å·
4. â³ **å¯é€‰**ï¼šè¿è¡Œ `Grade.updateAllPlayerTitles('chinesechess')` é‡æ–°è®¡ç®—æ‰€æœ‰çŽ©å®¶çš„ç§°å·

---

## ðŸ“Š æ—¥å¿—è°ƒè¯•

å½“è¿è¡Œæ¸¸æˆæ—¶ï¼Œåº”è¯¥çœ‹åˆ°è¿™æ ·çš„æ—¥å¿—ï¼š

```
[GRADE] getTitleByRank: rank=1, total=2
  checking ä¸¾ä¸–æ— åŒ: rank in [1, 1]? count=1
  âœ“ matched ä¸¾ä¸–æ— åŒ

[GRADE] getTitleByRank: rank=2, total=2
  checking ç™»å³°é€ æž: rank in [2, 2]? count=1
  âœ“ matched ç™»å³°é€ æž
```

è¿™è¡¨ç¤ºä¿®å¤æˆåŠŸ âœ“

