# HappyGames å¼€å‘æ–‡æ¡£

## 1. é¡¹ç›®æ¦‚è§ˆ (Project Overview)
HappyGames æ˜¯ä¸€ä¸ªåŸºäº Pi Network ç”Ÿæ€çš„æ¸¸æˆå¹³å°ï¼Œå…è®¸ç”¨æˆ·é€šè¿‡ Pi å¸å…‘æ¢â€œæ¬¢ä¹è±†â€å‚ä¸æ¸¸æˆï¼Œå¹¶èµšå–ä½£é‡‘ã€‚é¡¹ç›®é‡‡ç”¨ç°ä»£åŒ–çš„ Web æŠ€æœ¯æ ˆï¼Œæ³¨é‡ç”¨æˆ·ä½“éªŒå’Œè§†è§‰æ•ˆæœã€‚

### æŠ€æœ¯æ ˆ (Tech Stack)
- **å‰ç«¯**: Next.js 14 (React), TailwindCSS, TypeScript
- **åç«¯**: Node.js, Express, Socket.io, MongoDB
- **å›½é™…åŒ–**: è‡ªç ” React Context i18n æ–¹æ¡ˆ (æ”¯æŒ 14 ç§è¯­è¨€)

---

## 2. é¡¹ç›®é£æ ¼ä¸è®¾è®¡ (Project Style & Design)

### è§†è§‰ä¸»é¢˜ (Visual Theme)
é¡¹ç›®é‡‡ç”¨ **â€œæ´»åŠ›æ©™é»„â€ (Vibrant Amber/Yellow)** ä¸ºä¸»è‰²è°ƒï¼Œè¥é€ è½»æ¾ã€å¿«ä¹çš„æ¸¸æˆæ°›å›´ã€‚

- **èƒŒæ™¯**: å…¨å±€ä½¿ç”¨äº®é»„è‰²æ¸å˜èƒŒæ™¯ï¼Œä»æ·¡é»„ (`#FFF176`) è¿‡æ¸¡åˆ°æ©™é»„ (`#FFA726`)ï¼Œæ–¹å‘ä¸º 135 åº¦ã€‚
- **è´¨æ„Ÿ**: å¤§é‡ä½¿ç”¨ **Glassmorphism (æ¯›ç»ç’ƒ)** æ•ˆæœã€‚
    - å®¹å™¨èƒŒæ™¯: `bg-white/90` (90% ä¸é€æ˜åº¦ç™½è‰²)
    - æ¨¡ç³Šæ•ˆæœ: `backdrop-blur-sm`
    - è¾¹æ¡†: `border-white/50` (åŠé€æ˜ç™½è‰²è¾¹æ¡†)
    - é˜´å½±: `shadow-xl` æˆ– `shadow-2xl`
- **åœ†è§’**: ç»Ÿä¸€ä½¿ç”¨å¤§åœ†è§’ (`rounded-2xl`, `rounded-xl`)ï¼Œå¢å¼ºäº²å’ŒåŠ›ã€‚
- **å­—ä½“é¢œè‰²**:
    - ä¸»æ ‡é¢˜/å¼ºè°ƒæ–‡å­—: `text-amber-900` (æ·±ç¥ç€è‰²)
    - æ¬¡è¦æ–‡å­—: `text-gray-600`
    - æˆåŠŸ/æ”¶ç›Š: `text-green-600`
    - æ”¯å‡º/è­¦å‘Š: `text-red-600`

---

## 3. é¡µé¢å¸ƒå±€ä¸è®¾ç½® (Page Layouts)

### 3.1 é¦–é¡µ (Home Page)
- **å¸ƒå±€**: å±…ä¸­å¸ƒå±€ï¼Œå…¨å±æ˜¾ç¤ºã€‚
- **é¡¶éƒ¨å¯¼èˆª (Header)**:
    - å·¦ä¾§: å“ç‰Œåç§° "HappyGames"
    - å³ä¾§: è¯­è¨€åˆ‡æ¢å™¨ (Language Switcher) + ç”¨æˆ·å¤´åƒ/ç”¨æˆ·å (ç™»å½•å)
- **æ ¸å¿ƒåŒºåŸŸ (Hero Section)**:
    - **å¤§æ ‡é¢˜**: "HappyGames" (Games å­—æ ·ä½¿ç”¨ç¥ç€è‰²é«˜äº®)
    - **å‰¯æ ‡é¢˜**: å¤šè¯­è¨€æ”¯æŒçš„æ¬¢è¿è¯­ã€‚
    - **ç™»å½•å¡ç‰‡ (Login Card)**:
        - ä»…åœ¨æœªç™»å½•æ—¶æ˜¾ç¤ºã€‚
        - åŒ…å« "Login with Pi" æŒ‰é’®ï¼Œç‚¹å‡»è§¦å‘ Pi SDK è®¤è¯ã€‚
        - åº•éƒ¨æ˜¾ç¤ºéšç§åè®®æç¤ºã€‚
    - **è¿›å…¥å¤§å…æŒ‰é’®**: ç™»å½•åæ˜¾ç¤ºï¼Œç»¿è‰²æ¸å˜æŒ‰é’®ï¼Œå¼•å¯¼ç”¨æˆ·è¿›å…¥æ¸¸æˆå¤§å…ã€‚
- **è£…é¥°å…ƒç´ **: èƒŒæ™¯ä¸­æœ‰åŠ¨æ€æ¼‚æµ®çš„æ¨¡ç³Šå…‰æ–‘ï¼Œå¢åŠ é¡µé¢å±‚æ¬¡æ„Ÿã€‚

### 3.2 ä¸ªäººä¸­å¿ƒ (User Profile)
- **å¸ƒå±€**: å“åº”å¼å¸ƒå±€ã€‚ç§»åŠ¨ç«¯ä¸ºå•åˆ—ï¼Œæ¡Œé¢ç«¯ä¸ºåŒåˆ—ã€‚
- **å¤´éƒ¨ä¿¡æ¯æ  (Profile Header)**:
    - å·¦ä¾§: ç”¨æˆ·å¤§å¤´åƒ (å¸¦ç¥ç€è‰²å…‰æ™•) + ç”¨æˆ·å + å¾½ç«  (ç­‰çº§/æ¨å¹¿å‘˜) + ID æ˜¾ç¤ºã€‚
    - å³ä¾§: è¯­è¨€åˆ‡æ¢å™¨ + é€€å‡ºç™»å½•æŒ‰é’® (çº¢è‰²å¹½çµæŒ‰é’®)ã€‚
- **å†…å®¹åŒºåŸŸ**:
    - **å·¦åˆ—**: **èµ„äº§ä¸­å¿ƒ (Asset Center)** - *æ ¸å¿ƒåŠŸèƒ½åŒº*
    - **å³åˆ—**: **æ¨å¹¿æ•°æ® (Referral Stats)**
        - æ˜¾ç¤ºå·²é‚€è¯·äººæ•°ã€‚
        - æ˜¾ç¤ºæ€»æµæ°´ (Total Flow)ã€‚
        - æ˜¾ç¤ºä¸“å±æ¨å¹¿é“¾æ¥ (å¯å¤åˆ¶)ã€‚

---

## 4. èµ„äº§ä¸­å¿ƒè¯¦ç»†å¸ƒå±€ (Asset Center Layout)
ä½äº `WalletExchange.tsx` ç»„ä»¶ä¸­ï¼Œæ˜¯ç”¨æˆ·è¿›è¡Œå……å€¼å’Œæç°çš„æ ¸å¿ƒé¢æ¿ã€‚

### 4.1 é¡¶éƒ¨æ¦‚è§ˆ
- **æ ‡é¢˜**: "ğŸ’° èµ„äº§ä¸­å¿ƒ" (å¸¦å›¾æ ‡)ã€‚
- **ä½™é¢å¡ç‰‡**: å¹¶æ’å±•ç¤ºä¸¤ä¸ªå¡ç‰‡ã€‚
    - **æ¬¢ä¹è±† (HAPPY BEANS)**: æ©™è‰²èƒŒæ™¯ (`bg-orange-50`)ï¼Œæ˜¾ç¤ºå½“å‰æ¸¸æˆè´§å¸ä½™é¢ã€‚
    - **ä½£é‡‘ (COMMISSION)**: ç´«è‰²èƒŒæ™¯ (`bg-purple-50`)ï¼Œæ˜¾ç¤ºæ¨å¹¿èµšå–çš„ä½£é‡‘ä½™é¢ã€‚
- **æç¤ºæ **: è“è‰²èƒŒæ™¯ (`bg-blue-50`) çš„ä¿¡æ¯æ¡†ï¼Œè¯´æ˜æ”¯æŒçµæ´»è½¬è´¦ã€‚

### 4.2 æ“ä½œé€‰é¡¹å¡ (Tabs)
- ä½¿ç”¨ `bg-gray-100` çš„èƒ¶å›Šå¼åˆ‡æ¢å™¨ã€‚
- **å……å€¼ (Deposit)**: é€‰ä¸­æ—¶ç™½è‰²èƒŒæ™¯ï¼Œç¥ç€è‰²æ–‡å­—ã€‚
- **æç° (Withdraw)**: é€‰ä¸­æ—¶ç™½è‰²èƒŒæ™¯ï¼Œç¥ç€è‰²æ–‡å­—ã€‚

### 4.3 å……å€¼é¢æ¿ (Deposit Panel)
è®¾è®¡ä¸ºâ€œæ‰«ç /è½¬è´¦ -> ç¡®è®¤â€çš„æµç¨‹ã€‚
1.  **æ ‡é¢˜**: "æ‚¨çš„ä¸“å±å……å€¼åœ°å€"ã€‚
2.  **äºŒç»´ç åŒºåŸŸ**: å±…ä¸­æ˜¾ç¤ºçš„äºŒç»´ç å ä½ç¬¦ (ç™½è‰²æ–¹å—ï¼Œè™šçº¿è¾¹æ¡†)ã€‚
3.  **åœ°å€æ˜¾ç¤º**: 
    - æ ·å¼: `font-mono` (ç­‰å®½å­—ä½“)ï¼ŒåŠ ç²—ï¼Œæ–¹ä¾¿é˜…è¯»ã€‚
    - èƒŒæ™¯: ç™½è‰²èƒŒæ™¯ï¼Œç‹¬ç«‹è¾¹æ¡†ã€‚
4.  **å…å¤‡æ³¨æç¤º**: ç»¿è‰²èƒ¶å›Šæ ‡ç­¾ï¼Œå¼ºè°ƒ "æ— éœ€å¤‡æ³¨ (No Memo Required)"ã€‚
5.  **æ“ä½œæ­¥éª¤**: ç®€æ˜çš„ä¸¤æ­¥æŒ‡å¼• (Step 1 è½¬è´¦, Step 2 ç¡®è®¤)ã€‚
6.  **ç¡®è®¤æŒ‰é’®**: 
    - æ–‡å­—: "æˆ‘å·²è½¬è´¦ (æ£€æŸ¥å……å€¼)"
    - æ ·å¼: æ©™è‰²æ¸å˜ (`from-amber-500 to-orange-600`)ï¼Œå…¨å®½å¤§æŒ‰é’®ã€‚
    - äº¤äº’: ç‚¹å‡»åè§¦å‘åç«¯æŸ¥è¯¢ï¼Œæ¨¡æ‹ŸåŒºå—é“¾æ‰«æå»¶è¿Ÿã€‚
7.  **å……å€¼æˆåŠŸå¼¹çª— (Success Modal)**:
    - æ›¿ä»£åŸç”Ÿçš„ `alert` å¼¹çª—ã€‚
    - **UI**: ç™½è‰²åœ†è§’å¡ç‰‡ï¼Œç»¿è‰²æˆåŠŸå›¾æ ‡ï¼Œæ˜¾ç¤ºå……å€¼é‡‘é¢å’Œ Order IDã€‚
    - **äº¤äº’**: ç‚¹å‡» "Great!" æŒ‰é’®å…³é—­å¼¹çª—ã€‚

### 4.4 æç°é¢æ¿ (Withdraw Panel)
è¡¨å•å¼å¸ƒå±€ã€‚
1.  **æç°åœ°å€è¾“å…¥æ¡†**:
    - æ ‡ç­¾: "æç°åœ°å€" (å¤§å†™ï¼Œç°è‰²)ã€‚
    - è¾“å…¥æ¡†: å¤§åœ†è§’ï¼Œç™½è‰²èƒŒæ™¯ï¼Œè¾“å…¥ Pi é’±åŒ…åœ°å€ (G-...)ã€‚
2.  **æ•°é‡è¾“å…¥æ¡†**:
    - æ ‡ç­¾: "æ•°é‡ (æ¬¢ä¹è±†)"ã€‚
    - è¾“å…¥æ¡†: æ•°å­—è¾“å…¥ã€‚
3.  **æç°æŒ‰é’®**:
    - æ–‡å­—: "æç°"
    - æ ·å¼: åŒå……å€¼æŒ‰é’®ï¼Œæ©™è‰²æ¸å˜ã€‚
    - é€»è¾‘: æ£€æŸ¥ä½™é¢ -> æ‰£é™¤æ¬¢ä¹è±† -> æ¨¡æ‹Ÿå‘é€ Pi -> ç”Ÿæˆäº¤æ˜“è®°å½•ã€‚

### 4.5 äº¤æ˜“è®°å½• (Transaction History)
- **æ ‡é¢˜**: "äº¤æ˜“è®°å½•" (å¤§å†™ï¼Œç°è‰²å°å­—)ã€‚
- **åˆ—è¡¨**: æ»šåŠ¨åˆ—è¡¨ (`max-h-60 overflow-y-auto`)ã€‚
- **å•æ¡è®°å½•**:
    - å·¦ä¾§: ç±»å‹ (å……å€¼/æç°) + æ—¥æœŸã€‚
    - å³ä¾§: 
        - æ¬¢ä¹è±†å˜åŠ¨ (å……å€¼ç»¿è‰² `+`, æç°çº¢è‰² `-`)ã€‚
        - ä¼°ç®— Pi ä»·å€¼ (ç°è‰²å°å­—)ã€‚

---

## 5. å›½é™…åŒ–æ”¯æŒ (Internationalization)
- **æ”¯æŒè¯­è¨€**: 14 ç§ (è‹±è¯­, ä¸­æ–‡, æ—¥è¯­, éŸ©è¯­, ä¿„è¯­, å¾·è¯­, æ³•è¯­, é˜¿æ‹‰ä¼¯è¯­, è¶Šå—è¯­, è¥¿ç­ç‰™è¯­, è‘¡è„ç‰™è¯­, ç¹ä½“ä¸­æ–‡, é©¬æ¥è¯­, å¸Œä¼¯æ¥è¯­)ã€‚
- **å®ç°æ–¹å¼**: 
    - `LanguageContext`: å…¨å±€ç®¡ç†å½“å‰è¯­è¨€çŠ¶æ€ï¼ŒæŒä¹…åŒ–åˆ° `localStorage`ã€‚
    - `translations` å¯¹è±¡: åŒ…å«æ‰€æœ‰æ–‡æœ¬çš„é”®å€¼å¯¹å­—å…¸ã€‚
    - åŠ¨æ€æ›¿æ¢: é¡µé¢æ‰€æœ‰æ–‡æœ¬å‡é€šè¿‡ `t.key` æ–¹å¼è·å–ï¼Œç¡®ä¿åˆ‡æ¢è¯­è¨€æ—¶æ— ç¼æ›´æ–°ã€‚

---

## 6. ç”¨æˆ·èµ„æ–™å¢å¼º (User Profile Enhancements)

### 6.1 æ˜µç§°ç³»ç»Ÿ (Nickname System)
- **æ˜¾ç¤ºé€»è¾‘**: ä¼˜å…ˆæ˜¾ç¤ºç”¨æˆ·è®¾ç½®çš„æ˜µç§° (`nickname`)ï¼Œè‹¥æœªè®¾ç½®åˆ™å›é€€æ˜¾ç¤ºç”¨æˆ·å (`username`)ã€‚
- **ä¿®æ”¹åŠŸèƒ½**:
    - **å…¥å£**: ä¸ªäººä¸­å¿ƒç”¨æˆ·åæ—çš„â€œç¼–è¾‘â€å›¾æ ‡ (âœï¸)ã€‚
    - **äº¤äº’**: ç‚¹å‡»å›¾æ ‡å¼¹å‡ºè‡ªå®šä¹‰æ¨¡æ€æ¡† (Modal)ã€‚
    - **æ¨¡æ€æ¡†è®¾è®¡**:
        - é£æ ¼ä¸å…¨å±€ä¸€è‡´ (ç™½è‰²åœ†è§’å¡ç‰‡ï¼Œé˜´å½±ï¼Œç£¨ç ‚èƒŒæ™¯é®ç½©)ã€‚
        - åŒ…å«è¾“å…¥æ¡†å’Œâ€œå–æ¶ˆ/ä¿å­˜â€æŒ‰é’®ã€‚
    - **éªŒè¯é€»è¾‘**:
        - **å”¯ä¸€æ€§æ£€æŸ¥**: åç«¯ API (`/api/users/update`) åœ¨æ›´æ–°å‰ä¼šæŸ¥è¯¢æ•°æ®åº“ï¼Œç¡®ä¿æ˜µç§°å…¨å¹³å°å”¯ä¸€ã€‚
        - **é”™è¯¯å¤„ç†**: è‹¥æ˜µç§°å·²å­˜åœ¨ï¼Œè¿”å› 400 é”™è¯¯ï¼Œå‰ç«¯å¼¹å‡º Alert æç¤º "Nickname already taken"ã€‚

---

## 7. æ¸¸æˆé€»è¾‘ä¸ç»æµæ¨¡å‹ (Game Logic & Economics)

### 7.1 æ¸¸æˆç»“ç®—æœåŠ¡ (Game Settlement Service)
ç”± `GameService.js` ç»Ÿä¸€å¤„ç†æ¸¸æˆç»“æŸåçš„èµ„é‡‘æµè½¬ã€‚

1.  **ä¸‹æ³¨æ‰£é™¤**:
    - æ¸¸æˆå¼€å§‹æˆ–ç»“ç®—æ—¶ï¼Œç›´æ¥ä»ç©å®¶é’±åŒ… (`Wallet`) ä¸­æ‰£é™¤ä¸‹æ³¨é‡‘é¢ (`happyBeans`)ã€‚
    - ç”Ÿæˆç±»å‹ä¸º `BET` çš„äº¤æ˜“è®°å½•ã€‚

2.  **å¹³å°æœåŠ¡è´¹ (Platform Fee)**:
    - **è´¹ç‡**: å›ºå®šä¸º **5%** (`PLATFORM_FEE_RATE = 0.05`)ã€‚
    - **è®¡ç®—æ–¹å¼**: `æ€»æœåŠ¡è´¹ = æ€»ä¸‹æ³¨æ±  (Total Pot) * 0.05`ã€‚
    - **å•äººè´¡çŒ®è®°å½•**: ç³»ç»Ÿä¼šè®°å½•æ¯ä½ç©å®¶åœ¨è¯¥å±€æ¸¸æˆä¸­å®é™…è´¡çŒ®çš„æœåŠ¡è´¹é‡‘é¢ (`ç©å®¶ä¸‹æ³¨é¢ * 0.05`)ï¼Œç”¨äºåç»­ä½£é‡‘è®¡ç®—ã€‚

3.  **å¥–é‡‘åˆ†é…**:
    - `å‡€å¥–æ±  (Net Pot) = æ€»ä¸‹æ³¨æ±  - æ€»æœåŠ¡è´¹`ã€‚
    - å‡€å¥–æ± å¹³åˆ†ç»™æ‰€æœ‰èµ¢å®¶ã€‚
    - ç”Ÿæˆç±»å‹ä¸º `WIN` çš„äº¤æ˜“è®°å½•ã€‚

### 7.2 ä½£é‡‘æœºåˆ¶ (Commission Mechanism)
é‡‡ç”¨ **â€œå•äººè´¡çŒ®åˆ¶â€**ï¼Œç¡®ä¿ä½£é‡‘è®¡ç®—ç²¾ç¡®ä¸”å…¬å¹³ã€‚

- **æ ¸å¿ƒåŸåˆ™**: æ¨å¹¿å‘˜è·å¾—çš„ä½£é‡‘ï¼Œç›´æ¥æ¥æºäºå…¶ä¸‹çº¿ç©å®¶åœ¨æ¸¸æˆä¸­**å®é™…è´¡çŒ®çš„å¹³å°æœåŠ¡è´¹**ã€‚
- **è®¡ç®—å…¬å¼**:
    > `ä½£é‡‘ = ä¸‹çº¿ç©å®¶è´¡çŒ®çš„æœåŠ¡è´¹ * æ¨å¹¿å‘˜ç­‰çº§å¯¹åº”æ¯”ä¾‹`
- **ç­‰çº§æ¯”ä¾‹**:
    - Lv1: 10%
    - Lv2: 15%
    - Lv3: 20%
    - Lv4: 25%
    - Lv5: 30%
- **ç¤ºä¾‹**:
    - ç©å®¶ A (ä¸‹çº¿) ä¸‹æ³¨ 1000 è±†ã€‚
    - è´¡çŒ®æœåŠ¡è´¹ = 1000 * 5% = 50 è±†ã€‚
    - æ¨å¹¿å‘˜ B (Lv2, 15%) è·å¾—ä½£é‡‘ = 50 * 15% = 7.5 è±†ã€‚

### 7.3 æµæ°´ä¸å‡çº§ (Flow & Level Up)
- **æµæ°´å®šä¹‰**: ç©å®¶çš„**ä¸‹æ³¨é‡‘é¢**è®¡å…¥å…¶ä¸Šçº§æ¨å¹¿å‘˜çš„â€œæ€»æµæ°´â€ã€‚
- **å®æ—¶æ›´æ–°**: æ¯æ¬¡æ¸¸æˆç»“ç®—æ—¶ï¼Œè‡ªåŠ¨ç´¯åŠ æµæ°´åˆ°æ¨å¹¿å‘˜çš„ `referralStats.totalFlow`ã€‚
- **è‡ªåŠ¨å‡çº§**: ç³»ç»Ÿæ ¹æ®æœ€æ–°çš„é‚€è¯·äººæ•°å’Œæ€»æµæ°´ï¼Œè‡ªåŠ¨åˆ¤æ–­å¹¶æå‡æ¨å¹¿å‘˜ç­‰çº§ã€‚

---

## 8. æ¸¸æˆå¤§å… (Game Lobby)
ä½äº `GameList.tsx`ï¼Œæ˜¯ç©å®¶è¿›å…¥æ¸¸æˆçš„å…¥å£ã€‚

### 8.1 ç•Œé¢è®¾è®¡
- **é£æ ¼**: å»¶ç»­å…¨å±€çš„ "Glassmorphism" + "Vibrant Amber" é£æ ¼ã€‚
- **æ•°æ®çœ‹æ¿**:
    - **åœ¨çº¿ç©å®¶ (Online Players)**: è“è‰²å¡ç‰‡ï¼Œå®æ—¶æ˜¾ç¤ºå½“å‰åœ¨çº¿äººæ•°ã€‚
    - **ç”Ÿæ€æ±  (Eco Pool)**: ç»¿è‰²å¡ç‰‡ï¼Œæ˜¾ç¤ºå½“å‰ç”Ÿæ€æ± çš„ Pi å‚¨å¤‡é‡ã€‚
- **æ¸¸æˆåˆ—è¡¨**:
    - é‡‡ç”¨å¡ç‰‡å¼è®¾è®¡ï¼Œå±•ç¤ºæ¸¸æˆåç§°ã€å›¾æ ‡ã€æœ€ä½å‡†å…¥é‡‘é¢ã€‚
    - "Happy Poker" å¸¦æœ‰ "HOT" æ ‡ç­¾ã€‚

### 8.2 åŒ¹é…åŠŸèƒ½
- **å¿«é€ŸåŒ¹é… (Quick Match)**:
    - æŒ‰é’®å¸¦æœ‰åŠ è½½çŠ¶æ€ (Loading Spinner)ã€‚
    - ç‚¹å‡»åè§¦å‘ socket `start_matchmaking` äº‹ä»¶ã€‚
    - åŒ¹é…æˆåŠŸåå¼¹å‡ºæç¤ºå¹¶è·³è½¬ (ç›®å‰ä¸º Alert)ã€‚

### 8.3 å¤§å…åŠ¨æ€ (Lobby Feed)
æ›¿ä»£åŸæœ‰çš„åŒ¹é…è®¾ç½®é¢æ¿ï¼Œå±•ç¤ºå¤§å…å†…çš„å®æ—¶åŠ¨æ€ï¼Œå¢åŠ æ´»è·ƒæ°›å›´ã€‚
- **å±•ç¤ºå†…å®¹**:
    - ç”¨æˆ·è¿›å…¥å¤§å… (Join)ã€‚
    - ç”¨æˆ·èµ¢å¾—æ¸¸æˆ (Win)ã€‚
    - ç”¨æˆ·ä¸­å¤§å¥– (Jackpot)ã€‚
- **UI**: åˆ—è¡¨å¼å±•ç¤ºï¼Œä¸åŒç±»å‹çš„äº‹ä»¶å¸¦æœ‰ä¸åŒçš„å›¾æ ‡å’Œé¢œè‰²èƒŒæ™¯ã€‚

### 8.4 å›½é™…åŒ–æ–°å¢é”®å€¼

### 8.3 å›½é™…åŒ–æ–°å¢é”®å€¼
- `lobby_title`: æ¸¸æˆå¤§å…
- `online_players`: åœ¨çº¿ç©å®¶
- `eco_pool`: ç”Ÿæ€æ± 
- `quick_match`: å¿«é€ŸåŒ¹é…
- `game_poker`: æ¬¢ä¹æ‰‘å…‹
- `start_matching`: å¼€å§‹åŒ¹é…
- `lobby_feed`: å¤§å…åŠ¨æ€
- `recent_activity`: æœ€æ–°åŠ¨æ€


---

## 9. å¹³å°æ ¸å¿ƒæ¶æ„ (Platform Core Architecture)
ä¸ºäº†æ”¯æŒå¤šæ¸¸æˆå¿«é€Ÿæ‰©å±•ä¸é«˜å¹¶å‘ç¨³å®šæ€§ï¼Œå¹³å°é‡‡ç”¨äº† **æ’ä»¶åŒ– + æŒä¹…åŒ–** çš„æ ¸å¿ƒæ¶æ„ã€‚

### 9.1 æœåŠ¡ç«¯æ¶æ„ (Server Side)
ä½äº `server/src/gamecore`ï¼Œå®ç°äº†æ¸¸æˆé€»è¾‘ä¸å¹³å°æœåŠ¡çš„è§£è€¦ã€‚

#### A. æ’ä»¶åŒ–åˆ†å‘å™¨ (SocketDispatcher)
- **æ–‡ä»¶**: `server/src/gamecore/socket.js`
- **åŠŸèƒ½**: 
    - è‡ªåŠ¨æ‰«æ `server/src/games/` ç›®å½•ï¼ŒåŠ¨æ€åŠ è½½æ‰€æœ‰æ¸¸æˆç®¡ç†å™¨ã€‚
    - ç»Ÿä¸€å¤„ç† Socket è¿æ¥é‰´æƒ (`verifyToken`)ã€‚
    - æ ¹æ® `start_game` äº‹ä»¶å°†æµé‡åˆ†å‘è‡³å¯¹åº”çš„æ¸¸æˆç®¡ç†å™¨ã€‚

#### B. æ¸¸æˆåŸºç±» (BaseGameRoom)
- **æ–‡ä»¶**: `server/src/gamecore/BaseGameRoom.js`
- **åŠŸèƒ½**: æ‰€æœ‰æ¸¸æˆæˆ¿é—´çš„çˆ¶ç±»ï¼Œæä¾›æ ‡å‡†æ¥å£ã€‚
    - `broadcast(event, data)`: æˆ¿é—´å¹¿æ’­ã€‚
    - `settle(result)`: **å¼‚æ­¥ç»“ç®—**ã€‚è‡ªåŠ¨ç”Ÿæˆ `BatchId`ã€æ—¶é—´æˆ³ä¸ Nonceï¼Œå¹¶ä½¿ç”¨ HMAC-SHA256 ç­¾åè¯·æ±‚ç»“ç®— APIã€‚

#### C. èµ„é‡‘å®‰å…¨ç³»ç»Ÿ (Wallet & Settlement)
- **æ–‡ä»¶**: `server/src/gamecore/wallet.js` & `routes/settle.js`
- **æœºåˆ¶**:
    - **å¹‚ç­‰æ€§ (Idempotency)**: ä½¿ç”¨ `Batch` æ•°æ®åº“æ¨¡å‹è®°å½•æ¯ä¸€ç¬”ç»“ç®—çš„ `BatchId`ã€‚åœ¨äº‹åŠ¡ (Transaction) ä¸­åŸå­æ€§åœ°æ£€æŸ¥ `BatchId` æ˜¯å¦é‡å¤ï¼Œé˜²æ­¢èµ„é‡‘åŒé‡æ‰£é™¤ã€‚
    - **ç­¾åéªŒè¯**: ç»“ç®— API æ ¡éªŒ HTTP Header ä¸­çš„ `x-signature`ï¼Œé˜²æ­¢ä¼ªé€ è¯·æ±‚ã€‚

#### D. æŒä¹…åŒ–å±‚ (Persistence Layer)
- **çŠ¶æ€ç®¡ç†**: `server/src/gamecore/StateManager.js`
    - ä½¿ç”¨æ–‡ä»¶ç³»ç»Ÿ (`server/data/gamestate.json`) æŒä¹…åŒ–å­˜å‚¨æ¸¸æˆçŠ¶æ€ï¼Œé˜²æ­¢æœåŠ¡å™¨é‡å¯å¯¼è‡´å¯¹å±€æ•°æ®ä¸¢å¤±ã€‚
- **æ¶ˆæ¯é˜Ÿåˆ—**: `server/src/gamecore/queue.js`
    - ä½¿ç”¨æ–‡ä»¶ç³»ç»Ÿ (`server/data/queue.json`) æŒä¹…åŒ–ç»“ç®—ä»»åŠ¡ã€‚å³ä½¿åœ¨å¤„ç†ç»“ç®—æ—¶æœåŠ¡å™¨å®•æœºï¼Œé‡å¯åä¹Ÿä¼šè‡ªåŠ¨æ¢å¤å¹¶é‡è¯•ä»»åŠ¡ã€‚

### 9.2 å®¢æˆ·ç«¯æ¶æ„ (Client Side)
ä½äº `client/src/gamecore`ï¼Œå®ç°äº†å‰ç«¯æ¸¸æˆé€»è¾‘çš„æ’ä»¶åŒ–ã€‚

#### A. æ¸¸æˆå®¢æˆ·ç«¯åŸºç±» (BaseGameClient)
- **æ–‡ä»¶**: `client/src/gamecore/BaseGameClient.ts`
- **åŠŸèƒ½**: æŠ½è±¡ç±»ï¼Œå°è£…äº† Socket é€šä¿¡çš„åŸºç¡€é€»è¾‘ã€‚
    - `init/dispose`: ç»Ÿä¸€ç®¡ç†äº‹ä»¶ç›‘å¬å™¨çš„ç”Ÿå‘½å‘¨æœŸã€‚
    - `updateState`: æ ‡å‡†åŒ–çš„çŠ¶æ€æ›´æ–°ä¸ UI é€šçŸ¥æœºåˆ¶ã€‚

#### B. å®¢æˆ·ç«¯ç®¡ç†å™¨ (GameClientManager)
- **æ–‡ä»¶**: `client/src/gamecore/GameClientManager.ts`
- **åŠŸèƒ½**: å•ä¾‹æ¨¡å¼ï¼Œç®¡ç†å½“å‰æ¿€æ´»çš„æ¸¸æˆå®¢æˆ·ç«¯å®ä¾‹ï¼Œè´Ÿè´£ä¸åŒæ¸¸æˆä¹‹é—´çš„åˆ‡æ¢ä¸èµ„æºé‡Šæ”¾ã€‚

### 9.3 ç”¨æˆ·èº«ä»½æ ‡è¯†è§„èŒƒ (User Identity Standard) â­

ä¸ºäº†é˜²æ­¢ç¨‹åºäº§ç”Ÿæ··ä¹±ï¼Œå¹³å°åˆ¶å®šäº†ä¸¥æ ¼çš„ç”¨æˆ·èº«ä»½æ ‡è¯†è§„èŒƒã€‚

**æ ¸å¿ƒåŸåˆ™**: 
> **æ¸¸æˆå†…æ‰€æœ‰å¯¹ç”¨æˆ·çš„æ“ä½œï¼Œå‡ä»¥ç”¨æˆ·çš„ ID (`_id`) ä½œä¸ºç”¨æˆ·èº«ä»½çš„å”¯ä¸€è¾¨è¯†ä¾æ®ã€‚**

#### è§„èŒƒè¯¦æƒ…

1.  **å”¯ä¸€æ ‡è¯†ç¬¦**:
    -   å¿…é¡»ä½¿ç”¨ MongoDB ç”Ÿæˆçš„ `_id` (String æ ¼å¼)ã€‚
    -   **ç¦æ­¢** ä½¿ç”¨ `socket.id` ä½œä¸ºç”¨æˆ·æ ‡è¯†ï¼ˆå› é‡è¿ä¼šæ”¹å˜ï¼‰ã€‚
    -   **ç¦æ­¢** ä½¿ç”¨ `username` æˆ– `nickname` ä½œä¸ºç”¨æˆ·æ ‡è¯†ï¼ˆå¯èƒ½ä¸å”¯ä¸€æˆ–å¯å˜ï¼‰ã€‚

2.  **æœåŠ¡ç«¯å®ç°**:
    -   Socket è¿æ¥é‰´æƒåï¼Œ`socket.user._id` å³ä¸ºå¯ä¿¡çš„ç”¨æˆ· IDã€‚
    -   åœ¨æˆ¿é—´é€»è¾‘ã€åŒ¹é…é˜Ÿåˆ—ã€ç»“ç®—è®°å½•ä¸­ï¼Œç»Ÿä¸€ä½¿ç”¨ `userId` å­—æ®µå­˜å‚¨ã€‚
    -   **ä»£ç ç¤ºä¾‹**:
        ```javascript
        // âœ… æ­£ç¡®ï¼šä½¿ç”¨ userId
        const userId = socket.user._id.toString();
        this.players.find(p => p.userId === userId);

        // âŒ é”™è¯¯ï¼šä½¿ç”¨ socket.id
        this.players.find(p => p.socketId === socket.id);
        ```

3.  **å®¢æˆ·ç«¯å®ç°**:
    -   å®¢æˆ·ç«¯æ¥æ”¶åˆ°çš„æ‰€æœ‰ç”¨æˆ·æ•°æ®ï¼ˆå¦‚ `players` åˆ—è¡¨ï¼‰ï¼Œå¿…é¡»åŒ…å« `userId`ã€‚
    -   åˆ¤æ–­"æˆ‘æ˜¯è°"æˆ–"è½®åˆ°è°"æ—¶ï¼Œæ¯”è¾ƒ `currentUserId === player.userId`ã€‚

### 9.4 æœ¯è¯­è§„èŒƒ (Terminology Standard) â­

ä¸ºäº†ç¡®ä¿ä»£ç çš„å¯è¯»æ€§å’Œä¸€è‡´æ€§ï¼Œå¹³å°åˆ¶å®šäº†ä¸¥æ ¼çš„æœ¯è¯­è§„èŒƒã€‚

#### æ ¸å¿ƒæ¦‚å¿µå±‚çº§

```
å¹³å°å¤§å… (Platform Lobby)
    â””â”€â”€ æ¸¸æˆä¸­å¿ƒ (Game Center)
            â””â”€â”€ æ¸¸æˆå®¤ (Game Room / Tier)
                    â””â”€â”€ æ¸¸æˆæ¡Œ (Game Table)
```

#### è¯¦ç»†å®šä¹‰

**1. å¹³å°å¤§å… (Platform Lobby)**
- **å®šä¹‰**: ç”¨æˆ·ç™»å½•åçœ‹åˆ°çš„ä¸»ç•Œé¢
- **åŠŸèƒ½**: æ˜¾ç¤ºæ‰€æœ‰å¯ç”¨æ¸¸æˆçš„å…¥å£
- **ä»£ç å¯¹åº”**: `/lobby` è·¯ç”±
- **UIæ–‡æœ¬**: "è¿”å›å¤§å…"

**2. æ¸¸æˆä¸­å¿ƒ (Game Center)**
- **å®šä¹‰**: ç‰¹å®šæ¸¸æˆçš„ä¸»ç•Œé¢
- **ç¤ºä¾‹**: "ä¸­å›½è±¡æ£‹æ¸¸æˆä¸­å¿ƒ"
- **åŠŸèƒ½**: æ˜¾ç¤ºè¯¥æ¸¸æˆçš„æ‰€æœ‰æ¸¸æˆå®¤é€‰é¡¹å’Œç©å®¶ç»Ÿè®¡
- **ä»£ç å¯¹åº”**: `/game/chinesechess` è·¯ç”±
- **UIæ–‡æœ¬**: "ä¸­å›½è±¡æ£‹æ¸¸æˆä¸­å¿ƒ"ã€"è¿”å›æ¸¸æˆä¸­å¿ƒ"

**3. æ¸¸æˆå®¤ (Game Room / Tier)** â­ é‡ç‚¹
- **å®šä¹‰**: æŒ‰ç­‰çº§åˆ†ç±»çš„æ¸¸æˆåŒºåŸŸï¼Œç©å®¶ç‚¹å‡»åè¿›å…¥çš„ç•Œé¢
- **ç¤ºä¾‹**: 
  - å…è±†å®¤ (free) - æ— éœ€æ¸¸æˆè±†
  - åˆçº§å®¤ (beginner) - ç­‰çº§åˆ† < 1500
  - ä¸­çº§å®¤ (intermediate) - ç­‰çº§åˆ† 1500-1800
  - é«˜çº§å®¤ (advanced) - ç­‰çº§åˆ† > 1800
- **åŠŸèƒ½**: 
  - æ˜¾ç¤ºè¯¥æ¸¸æˆå®¤å†…çš„æ‰€æœ‰æ¸¸æˆæ¡Œ
  - æä¾›å¿«é€Ÿå¼€å§‹åŠŸèƒ½
  - é™åˆ¶ç©å®¶ç­‰çº§åˆ†è®¿é—®
- **ä»£ç å¯¹åº”**: 
  - å˜é‡å: `tier` (free/beginner/intermediate/advanced)
  - è·¯ç”±: `/game/chinesechess/play?tier=beginner`
  - æ•°æ®ç»“æ„: `BaseGameManager.rooms[tier]` æ˜¯è¯¥æ¸¸æˆå®¤çš„æ¸¸æˆæ¡Œåˆ—è¡¨
- **UIæ–‡æœ¬**: "åˆçº§å®¤"ã€"ä¸­çº§å®¤"ã€"è¿›å…¥æ¸¸æˆå®¤"

**4. æ¸¸æˆæ¡Œ (Game Table)** â­ é‡ç‚¹
- **å®šä¹‰**: å…·ä½“çš„å¯¹å±€å®ä¾‹ï¼Œç©å®¶ååœ¨æ¡Œä¸Šè¿›è¡Œæ¸¸æˆ
- **ç¤ºä¾‹**: `chinesechess_beginner_0`
- **åŠŸèƒ½**:
  - ç©å®¶å…¥åº§
  - ç­‰å¾…å¯¹æ‰‹
  - è¿›è¡Œæ¸¸æˆ
  - æ—è§‚
- **ä»£ç å¯¹åº”**:
  - å˜é‡å: `room`, `roomId`
  - ç±»: `MatchableGameRoom` çš„å®ä¾‹
  - ç¤ºä¾‹ID: `chinesechess_beginner_0`
- **UIæ–‡æœ¬**: "æ¸¸æˆæ¡Œ 1"ã€"æ¡Œå·: 1"ã€"å…¥åº§"

#### ä»£ç è§„èŒƒ

**å˜é‡å‘½å**
```javascript
// âœ… æ­£ç¡®
const tier = 'beginner';           // æ¸¸æˆå®¤ç­‰çº§
const roomId = 'chess_beginner_0'; // æ¸¸æˆæ¡ŒID
const room = new ChineseChessRoom(); // æ¸¸æˆæ¡Œå®ä¾‹

// âŒ é”™è¯¯ - é¿å…æ··æ·†
const room = 'beginner';  // ä¸è¦ç”¨ room æŒ‡ä»£ tier
const tier = 'chess_beginner_0';  // ä¸è¦ç”¨ tier æŒ‡ä»£æ¸¸æˆæ¡Œ
```

**æ³¨é‡Šè§„èŒƒ**
```javascript
// âœ… æ­£ç¡®
// åˆ›å»ºæ¸¸æˆæ¡Œ
const room = new ChineseChessRoom(io, roomId, tier);

// å°†æ¸¸æˆæ¡Œæ·»åŠ åˆ°å¯¹åº”æ¸¸æˆå®¤
this.rooms[tier].push(room);

// ç©å®¶è¿›å…¥æ¸¸æˆå®¤
router.push(`/game/chinesechess/play?tier=beginner`);

// ç©å®¶åŠ å…¥æ¸¸æˆæ¡Œ
room.playerJoin(socket);

// âŒ é”™è¯¯ - ä¸æ˜ç¡®
// åˆ›å»ºæˆ¿é—´
const room = new ChineseChessRoom();
```

**æ—¥å¿—è¾“å‡ºè§„èŒƒ**
```javascript
// âœ… æ­£ç¡®
console.log(`Created game table: ${roomId} in ${tier} room`);
console.log(`Player entered ${tier} game room`);
console.log(`Sending ${count} tables from ${tier} room to player`);

// âŒ é”™è¯¯ - ä¸æ˜ç¡®
console.log(`Created room: ${roomId}`);
console.log(`Player joined room`);
```

**æ–¹æ³•å‘½åè§„èŒƒ**
```javascript
// BaseGameManager ä¸­çš„æ–¹æ³•
handleGetRooms(socket, user, tier)  // è·å–æŒ‡å®šæ¸¸æˆå®¤çš„æ¸¸æˆæ¡Œåˆ—è¡¨
canAccessTier(tier, rating)         // éªŒè¯ç©å®¶æ˜¯å¦æœ‰æƒé™è¿›å…¥æ¸¸æˆå®¤
getRoomList(tier)                   // è·å–æ¸¸æˆå®¤çš„æ¸¸æˆæ¡Œåˆ—è¡¨

// MatchableGameRoom ä¸­çš„æ–¹æ³•
playerJoin(socket)    // ç©å®¶åŠ å…¥æ¸¸æˆæ¡Œ
playerLeave(socket)   // ç©å®¶ç¦»å¼€æ¸¸æˆæ¡Œ
```

#### UIæ–‡æœ¬è§„èŒƒ

**ä¸­æ–‡ç•Œé¢**
- æ¸¸æˆä¸­å¿ƒ: "ä¸­å›½è±¡æ£‹æ¸¸æˆä¸­å¿ƒ"
- æ¸¸æˆå®¤: "åˆçº§å®¤"ã€"ä¸­çº§å®¤"ã€"é«˜çº§å®¤"ã€"å…è±†å®¤"
- æ¸¸æˆæ¡Œ: "æ¸¸æˆæ¡Œ 1"ã€"æ¸¸æˆæ¡Œ 2" æˆ– "æ¡Œå·: 1"
- æŒ‰é’®æ–‡æœ¬:
  - "è¿›å…¥æ¸¸æˆå®¤" (ç‚¹å‡»æ¸¸æˆå®¤å›¾æ ‡)
  - "å…¥åº§" (åŠ å…¥æ¸¸æˆæ¡Œ)
  - "è¿”å›æ¸¸æˆä¸­å¿ƒ" (ä»æ¸¸æˆå®¤è¿”å›)
  - "è¿”å›å¤§å…" (ä»æ¸¸æˆä¸­å¿ƒè¿”å›)

**è‹±æ–‡ç•Œé¢**
- Game Center: "Chinese Chess Game Center"
- Game Room: "Beginner Room", "Intermediate Room", "Advanced Room", "Free Room"
- Game Table: "Table 1", "Table 2"
- Button Text:
  - "Enter Room" (è¿›å…¥æ¸¸æˆå®¤)
  - "Sit Down" (å…¥åº§)
  - "Back to Game Center" (è¿”å›æ¸¸æˆä¸­å¿ƒ)
  - "Back to Lobby" (è¿”å›å¤§å…)

#### æ•°æ®ç»“æ„ç¤ºä¾‹

**BaseGameManager.rooms**
```javascript
{
  free: [table1, table2, table3],      // å…è±†å®¤çš„æ¸¸æˆæ¡Œåˆ—è¡¨
  beginner: [table1, table2, table3],  // åˆçº§å®¤çš„æ¸¸æˆæ¡Œåˆ—è¡¨
  intermediate: [table1, table2],      // ä¸­çº§å®¤çš„æ¸¸æˆæ¡Œåˆ—è¡¨
  advanced: [table1]                   // é«˜çº§å®¤çš„æ¸¸æˆæ¡Œåˆ—è¡¨
}
```

**æ¸¸æˆæ¡Œå¯¹è±¡**
```javascript
{
  roomId: 'chinesechess_beginner_0',  // æ¸¸æˆæ¡ŒID
  tier: 'beginner',                   // æ‰€å±æ¸¸æˆå®¤
  status: 'waiting',                  // æ¸¸æˆæ¡ŒçŠ¶æ€
  players: [...],                     // ç©å®¶åˆ—è¡¨
  spectators: [...]                   // è§‚ä¼—åˆ—è¡¨
}
```

#### å¸¸è§é”™è¯¯ä¸æ­£ç¡®ç¤ºä¾‹

**âŒ é”™è¯¯**
```javascript
// æ··æ·†æ¸¸æˆå®¤å’Œæ¸¸æˆæ¡Œ
console.log('Player joined room beginner');

// ä½¿ç”¨ room æŒ‡ä»£æ¸¸æˆå®¤
const room = 'beginner';

// æ³¨é‡Šä¸å‡†ç¡®
// åˆ›å»ºæˆ¿é—´
const table = new ChineseChessRoom();
```

**âœ… æ­£ç¡®**
```javascript
// æ˜ç¡®åŒºåˆ†
console.log('Player entered beginner game room');
console.log('Player joined game table: chess_beginner_0');

// æ­£ç¡®å‘½å
const tier = 'beginner';
const roomId = 'chess_beginner_0';

// å‡†ç¡®æ³¨é‡Š
// åˆ›å»ºæ¸¸æˆæ¡Œå¹¶æ·»åŠ åˆ°å¯¹åº”æ¸¸æˆå®¤
const table = new ChineseChessRoom(io, roomId, tier);
this.rooms[tier].push(table);
```

#### æ ¸å¿ƒåŸåˆ™

**è®°ä½è¿™ä¸ªå±‚çº§å…³ç³»**:
1. ç©å®¶ä»**å¹³å°å¤§å…**é€‰æ‹©æ¸¸æˆ
2. è¿›å…¥**æ¸¸æˆä¸­å¿ƒ**
3. é€‰æ‹©**æ¸¸æˆå®¤**ç­‰çº§
4. çœ‹åˆ°è¯¥æ¸¸æˆå®¤å†…çš„æ‰€æœ‰**æ¸¸æˆæ¡Œ**
5. é€‰æ‹©ä¸€ä¸ª**æ¸¸æˆæ¡Œ**å…¥åº§æˆ–å¿«é€Ÿå¼€å§‹è‡ªåŠ¨åŒ¹é…

**å…³é”®ç‚¹**: 
- `tier` = æ¸¸æˆå®¤ç­‰çº§
- `room`/`roomId` = æ¸¸æˆæ¡Œ
- å§‹ç»ˆæ˜ç¡®åŒºåˆ†è¿™ä¸¤ä¸ªæ¦‚å¿µ
- æ‰€æœ‰ä»£ç ã€æ³¨é‡Šã€æ—¥å¿—å’ŒUIæ–‡æœ¬éƒ½å¿…é¡»éµå¾ªæ­¤è§„èŒƒ


---

## 10. ELO ç­‰çº§åˆ†ç³»ç»Ÿ (ELO Rating System)
ä¸ºåŒäººç«æŠ€ç±»æ¸¸æˆæä¾›å…¬å¹³çš„æŠ€èƒ½è¯„ä¼°ä¸åŒ¹é…æœºåˆ¶ã€‚

### 10.1 åŠ¨æ€ K å€¼è®¡ç®—
é‡‡ç”¨åŒå› ç´ å¹³æ»‘ç®—æ³•ï¼Œé¿å…ç§¯åˆ†å‰§çƒˆæ³¢åŠ¨ã€‚

#### å…¬å¼
```
K_Final = 4 + 36 Ã— f_rating Ã— f_games
```

- **å¯¹å±€æ•°å› å­ (f_games)**:
  ```
  f_games = 1 / (1 + Games/50)
  ```
  æ–°æ‰‹ç©å®¶ï¼ˆå¯¹å±€æ•°å°‘ï¼‰Kå€¼è¾ƒé«˜ï¼Œç§¯åˆ†å˜åŒ–å¿«ï¼›è€æ‰‹Kå€¼ä½ï¼Œç§¯åˆ†ç¨³å®šã€‚

- **ç­‰çº§åˆ†å› å­ (f_rating)**:
  ```
  è‹¥ Rating < mu_dynamic: f_rating = 1
  è‹¥ Rating >= mu_dynamic: f_rating = 1 / (1 + (Rating - mu_dynamic)/1000)
  ```
  `mu_dynamic` ä¸ºå½“å‰æ¸¸æˆæ‰€æœ‰ç©å®¶çš„å¹³å‡ç­‰çº§åˆ†ï¼Œæ¯æ—¥ 11:00 UTC è®¡ç®—ï¼Œ12:00 UTC ç”Ÿæ•ˆã€‚

#### é¢„æœŸèƒœç‡ä¸ç§¯åˆ†å˜åŠ¨
- **é¢„æœŸèƒœç‡**: `E_A = 1 / (1 + 10^((R_B - R_A)/400))`
- **ç§¯åˆ†å˜åŠ¨**: `Delta = Round(K_Final Ã— (å®é™…å¾—åˆ† - é¢„æœŸå¾—åˆ†))`
  - èƒœ: 1åˆ†ï¼Œå’Œ: 0.5åˆ†ï¼Œè´Ÿ: 0åˆ†

### 10.2 æ—¶é—´è¡°å‡æœºåˆ¶
é˜²æ­¢é«˜åˆ†ç©å®¶é•¿æœŸä¸æ´»è·ƒå¯¼è‡´æ’è¡Œæ¦œåƒµåŒ–ã€‚

- **è¡°å‡é˜ˆå€¼**: 1600åˆ†
- **ä¸æ´»è·ƒå‘¨æœŸ**: 7å¤©
- **è¡°å‡ç‡**: æ¯å‘¨ 1%
- **è¡°å‡å…¬å¼**: `Decay = 0.01 Ã— (Rating - 1600)`
- **æ‰§è¡Œæ—¶é—´**: æ¯æ—¥ 10:00 UTC

### 10.3 å®ç°æ–‡ä»¶
- **æœåŠ¡ç«¯**: `server/src/gamecore/EloService.js`
- **æ•°æ®æ¨¡å‹**: `server/src/models/UserGameStats.js`, `server/src/models/GameMeta.js`
- **å®šæ—¶ä»»åŠ¡**: `server/src/cron/eloCron.js`

---

## 11. ç§°å·ç³»ç»Ÿ (Title System)
åŸºäºç™¾åˆ†æ¯”æ’åçš„è£èª‰ç§°å·ä½“ç³»ï¼Œé€‚ç”¨äºä¸­å›½è±¡æ£‹ç­‰ç«æŠ€æ¸¸æˆã€‚

### 11.1 ç§°å·åˆ†æ®µ
| ç¼–å· | ç§°å·åç§° | äººæ•°å æ¯” | é¢œè‰² | å®šä½ |
|------|----------|----------|------|------|
| 1 | åˆå‡ºèŒ…åº | 22% | é»‘è‰² #000000 | æ–°æ‰‹ |
| 2 | å°è¯•ç‰›åˆ€ | 19% | æ£•è‰² #8f2d56 | æ™®é€šè¿›é˜¶ |
| 3 | æ¸å…¥ä½³å¢ƒ | 16% | ç»¿è‰² #00FF00 | ä½ä¸­æ°´å¹³ |
| 4 | é”‹èŠ’æ¯•éœ² | 13% | è“è‰² #0000FF | ä¸­ç­‰åä¸Š |
| 5 | å‡ºç±»æ‹”èƒ | 10% | çº¢è‰² #FF0000 | é«˜æ°´å¹³ç²¾è‹± |
| 6 | ç‚‰ç«çº¯é’ | 8% | é’è‰² #00FFFF | é¡¶å°–æŠ€æœ¯ |
| 7 | åæ»¡æ±Ÿæ¹– | 6% | é»„è‰² #ffee32 | ç¨€æœ‰å¼ºè€… |
| 8 | å‚²è§†ç¾¤é›„ | 4% | ç´«è‰² #800080 | é«˜ç«¯æå°‘æ•° |
| 9 | ç™»å³°é€ æ | 2% | é‡‘è‰² #ffba08 | æœåŠ¡å™¨é¡¶å°– |
| 10 | ä¸¾ä¸–æ— åŒ | ä»…1äºº | æ©™è‰² #FF6200 | ç»å¯¹å”¯ä¸€è£èª‰ |

### 11.2 æ›´æ–°æœºåˆ¶
- **ç»Ÿè®¡æ—¶é—´**: æ¯æ—¥ 9:00 UTC
- **ç”Ÿæ•ˆæ—¶é—´**: æ¬¡æ—¥ 9:00 UTC
- **è®¡ç®—é€»è¾‘**: æŒ‰ç­‰çº§åˆ†é™åºæ’åˆ—ï¼Œæ ¹æ®ç™¾åˆ†æ¯”åˆ†é…ç§°å·
- **æ˜¾ç¤ºä½ç½®**: ç”¨æˆ·ååï¼Œä½¿ç”¨å¯¹åº”é¢œè‰²

### 11.3 å®ç°æ–‡ä»¶
- **æœåŠ¡ç«¯**: `server/src/gamecore/TitleService.js`
- **å®šæ—¶ä»»åŠ¡**: `server/src/cron/eloCron.js`

---

## 12. ä¸­å›½è±¡æ£‹æ¸¸æˆ (Chinese Chess - Xiangqi)
å®Œæ•´å®ç°ä¸­å›½è±¡æ£‹æ¸¸æˆè§„åˆ™ä¸åˆ†çº§æˆ¿é—´ç³»ç»Ÿã€‚

### 12.1 æ¸¸æˆæ¶æ„
é‡‡ç”¨æ’ä»¶åŒ–è®¾è®¡ï¼Œå®Œå…¨ç¬¦åˆå¹³å°æ ¸å¿ƒæ¶æ„è§„èŒƒã€‚

#### æœåŠ¡ç«¯ç»“æ„
```
server/src/games/chinesechess/
â”œâ”€â”€ index.js                    # ChineseChessManager (æ¸¸æˆç®¡ç†å™¨)
â”œâ”€â”€ logic/
â”‚   â””â”€â”€ XiangqiRules.js        # è§„åˆ™å¼•æ“
â””â”€â”€ rooms/
    â””â”€â”€ ChineseChessRoom.js    # æ¸¸æˆæˆ¿é—´é€»è¾‘
```

#### å®¢æˆ·ç«¯ç»“æ„
```
client/src/
â”œâ”€â”€ app/game/chinesechess/
â”‚   â”œâ”€â”€ page.tsx               # æ¸¸æˆä¸­å¿ƒ (æˆ¿é—´é€‰æ‹©)
â”‚   â””â”€â”€ play/page.tsx          # æ¸¸æˆå¯¹å±€é¡µé¢
â””â”€â”€ components/ChineseChess/
    â”œâ”€â”€ ChineseChessClient.ts  # æ¸¸æˆå®¢æˆ·ç«¯é€»è¾‘
    â””â”€â”€ ChessBoard.tsx         # æ£‹ç›˜ UI (Canvas)
```

### 12.2 æ¸¸æˆå®¤åˆ†çº§ç³»ç»Ÿ (Game Room Tiers)
| æ¸¸æˆå®¤ç±»å‹ | ç­‰çº§åˆ†è¦æ±‚ | åº•è±† | è¯´æ˜ |
|----------|------------|------|------|
| å…è±†å®¤ | æ— é™åˆ¶ | 0 | æ‰€æœ‰ç©å®¶å¯å‚ä¸ï¼Œä¸æ¶ˆè€—æ¸¸æˆè±† |
| åˆçº§å®¤ | < 1500 | 100 | æ–°æ‰‹ä¸“å± |
| ä¸­çº§å®¤ | 1500-1800 | 1000 | ä¸­ç­‰æ°´å¹³ç©å®¶ |
| é«˜çº§å®¤ | > 1800 | 10000 | é«˜æ‰‹å¯¹å†³ |

- **è®¿é—®æ§åˆ¶**: ç©å®¶åªèƒ½è¿›å…¥ç¬¦åˆè‡ªå·±ç­‰çº§åˆ†çš„æ¸¸æˆå®¤
- **æ¸¸æˆæ¡Œ (Game Table)**: æ¯ä¸ªæ¸¸æˆå®¤å†…åŒ…å«è‹¥å¹²æ¸¸æˆæ¡Œï¼Œç©å®¶åœ¨æ¡Œä¸Šè¿›è¡Œå¯¹å±€
- **è§‚æˆ˜åŠŸèƒ½**: å¯è¿›å…¥ä»»æ„æ¸¸æˆæ¡Œè§‚æˆ˜

### 12.3 æ¸¸æˆè§„åˆ™å®ç°
`XiangqiRules.js` å®Œæ•´å®ç°æ‰€æœ‰æ£‹å­èµ°æ³•éªŒè¯ï¼š

- **å¸…/å°† (King)**: ä¹å®«æ ¼å†…ç›´çº¿ç§»åŠ¨1æ­¥
- **ä»•/å£« (Advisor)**: ä¹å®«æ ¼å†…æ–œçº¿ç§»åŠ¨1æ­¥
- **ç›¸/è±¡ (Elephant)**: ç”°å­—ç§»åŠ¨ï¼Œä¸å¯è¿‡æ²³ï¼Œæ£€æŸ¥è±¡çœ¼é˜»æŒ¡
- **é©¬ (Horse)**: æ—¥å­—ç§»åŠ¨ï¼Œæ£€æŸ¥é©¬è…¿é˜»æŒ¡
- **è½¦ (Rook)**: ç›´çº¿ç§»åŠ¨ï¼Œè·¯å¾„æ— é˜»æŒ¡
- **ç‚® (Cannon)**: ç›´çº¿ç§»åŠ¨ï¼Œåƒå­éœ€éš”ä¸€å­
- **å…µ/å’ (Pawn)**: è¿‡æ²³å‰åªèƒ½å‰è¿›ï¼Œè¿‡æ²³åå¯æ¨ªç§»

### 12.4 æ£‹ç›˜æ¸²æŸ“
- **æŠ€æœ¯**: HTML5 Canvas
- **å°ºå¯¸**: 9Ã—10 æ ¼
- **æ£‹å­**: ä½¿ç”¨ä¸­æ–‡å­—ç¬¦ (å¸…/å°†ã€ä»•/å£«ã€ç›¸/è±¡ã€é©¬ã€è½¦ã€ç‚®ã€å…µ/å’)
- **é¢œè‰²**: çº¢æ–¹ (#FF6B6B)ï¼Œé»‘æ–¹ (#4ECDC4)
- **äº¤äº’**: ç‚¹å‡»é€‰ä¸­ï¼Œå†æ¬¡ç‚¹å‡»ç§»åŠ¨

### 12.5 ç»“ç®—æµç¨‹
1. **èƒœè´Ÿåˆ¤å®š**: åƒæ‰å¯¹æ–¹å°†/å¸…
2. **ELO æ›´æ–°**: è°ƒç”¨ `EloService.processMatchResult()`
3. **æ¸¸æˆè±†ç»“ç®—**: éå…è´¹å®¤è°ƒç”¨ `BaseGameRoom.settle()`
4. **ç§°å·åˆ·æ–°**: æ¬¡æ—¥ 9:00 UTC è‡ªåŠ¨æ›´æ–°

### 12.6 å›½é™…åŒ–æ”¯æŒ
æ¸¸æˆä¸­å¿ƒå’Œå¯¹å±€é¡µé¢å·²é›†æˆå¤šè¯­è¨€æ”¯æŒï¼Œä¸»è¦æ–‡æœ¬é”®å€¼ï¼š
- `chess_center`: è±¡æ£‹ä¸­å¿ƒ
- `free_room`: å…è´¹å®¤
- `beginner_room`: åˆçº§å®¤
- `intermediate_room`: ä¸­çº§å®¤
- `advanced_room`: é«˜çº§å®¤
- `your_turn`: ä½ çš„å›åˆ
- `waiting_opponent`: ç­‰å¾…å¯¹æ‰‹

---

## 13. ç”Ÿäº§ç¯å¢ƒé—®é¢˜ä¿®å¤è®°å½• (Production Issues Fix Log)

### 13.1 CORS è·¨åŸŸé—®é¢˜ä¿®å¤ (2025-11-27)

#### é—®é¢˜æè¿°
ç”Ÿäº§ç¯å¢ƒ (`https://www.happygames.online`) è®¿é—®åç«¯æœåŠ¡å™¨ (`https://happygames-tfdz.onrender.com`) æ—¶å‡ºç°ä»¥ä¸‹é”™è¯¯ï¼š

1. **CORS ç­–ç•¥é˜»æ­¢**:
   ```
   Access to fetch at 'https://happygames-tfdz.onrender.com/socket.io/...' 
   from origin 'https://www.happygames.online' has been blocked by CORS policy: 
   No 'Access-Control-Allow-Origin' header is present on the requested resource.
   ```

2. **æœåŠ¡å™¨é”™è¯¯**:
   - `503 Service Unavailable` - æœåŠ¡å™¨ä¼‘çœ ï¼ˆRender å…è´¹ç‰ˆç‰¹æ€§ï¼‰
   - `502 Bad Gateway` - ç½‘å…³é”™è¯¯

3. **Socket.IO è¿æ¥å¤±è´¥**:
   ```
   Socket connection error: xhr poll error
   ```

#### æ ¹æœ¬åŸå› åˆ†æ
1. **CORS é…ç½®ä¸å®Œæ•´**: 
   - åŸé…ç½®ä½¿ç”¨ `origin || '*'` çš„å®½æ¾ç­–ç•¥ï¼Œä½†åœ¨æŸäº›æƒ…å†µä¸‹æµè§ˆå™¨ä»ä¼šæ‹’ç»è¯·æ±‚
   - Socket.IO çš„ CORS é…ç½®ä¸ HTTP ä¸­é—´ä»¶é…ç½®ä¸ä¸€è‡´

2. **Render å…è´¹ç‰ˆé™åˆ¶**:
   - æœåŠ¡å™¨åœ¨ 15 åˆ†é’Ÿæ— æ´»åŠ¨åè‡ªåŠ¨ä¼‘çœ 
   - é¦–æ¬¡å”¤é†’è¯·æ±‚å¯èƒ½è¶…æ—¶æˆ–å¤±è´¥

3. **æ„é€ å‡½æ•°å‚æ•°é¡ºåºé”™è¯¯**:
   - `ChineseChessRoom` è°ƒç”¨çˆ¶ç±» `BaseGameRoom` æ—¶å‚æ•°é¡ºåºé”™è¯¯
   - å¯èƒ½å¯¼è‡´å†…éƒ¨é€»è¾‘å¼‚å¸¸

#### ä¿®å¤æ–¹æ¡ˆ

##### A. HTTP CORS ä¸­é—´ä»¶ä¼˜åŒ–
**æ–‡ä»¶**: `server/src/index.js`

**ä¿®æ”¹å‰**:
```javascript
app.use((req, res, next) => {
    const origin = req.headers.origin;
    res.header('Access-Control-Allow-Origin', origin || '*');
    // ...
});
```

**ä¿®æ”¹å**:
```javascript
app.use((req, res, next) => {
    const origin = req.headers.origin;
    
    // ç™½åå•é…ç½®
    const allowedOrigins = [
        'https://www.happygames.online',
        'https://happygames.online',
        'http://localhost:3000',
        'http://localhost:3001'
    ];
    
    // æ™ºèƒ½åŒ¹é…ç­–ç•¥
    if (allowedOrigins.includes(origin) || !origin || process.env.NODE_ENV === 'development') {
        res.header('Access-Control-Allow-Origin', origin || '*');
    } else {
        // æœªçŸ¥æ¥æºé»˜è®¤å…è®¸ä¸»åŸŸå
        res.header('Access-Control-Allow-Origin', 'https://www.happygames.online');
    }
    
    res.header('Access-Control-Allow-Credentials', 'true');
    res.header('Access-Control-Allow-Methods', 'GET, POST, PUT, DELETE, OPTIONS');
    res.header('Access-Control-Allow-Headers', 'Content-Type, Authorization, X-Requested-With, Accept');

    if (req.method === 'OPTIONS') {
        return res.sendStatus(200);
    }

    console.log(`[${new Date().toISOString()}] ${req.method} ${req.url}`);
    next();
});
```

**ä¼˜åŒ–ç‚¹**:
- âœ… æ˜ç¡®çš„ç™½åå•æœºåˆ¶ï¼Œæé«˜å®‰å…¨æ€§
- âœ… æ”¯æŒå¼€å‘ç¯å¢ƒçš„çµæ´»é…ç½®
- âœ… æœªçŸ¥æ¥æºçš„å…œåº•ç­–ç•¥
- âœ… å®Œæ•´çš„é¢„æ£€è¯·æ±‚å¤„ç†

##### B. Socket.IO CORS é…ç½®åŒæ­¥
**æ–‡ä»¶**: `server/src/gamecore/socket.js`

**ä¿®æ”¹å‰**:
```javascript
this.io = socketIo(server, {
    cors: {
        origin: (origin, callback) => {
            callback(null, true); // å…è®¸æ‰€æœ‰æ¥æº
        },
        // ...
    }
});
```

**ä¿®æ”¹å**:
```javascript
this.io = socketIo(server, {
    cors: {
        origin: (origin, callback) => {
            const allowedOrigins = [
                'https://www.happygames.online',
                'https://happygames.online',
                'http://localhost:3000',
                'http://localhost:3001'
            ];
            
            // ç™½åå•éªŒè¯ + æ—¥å¿—è®°å½•
            if (!origin || allowedOrigins.includes(origin) || process.env.NODE_ENV === 'development') {
                callback(null, true);
            } else {
                callback(null, true); // ä»å…è®¸ä½†è®°å½•è­¦å‘Š
                console.warn(`[Socket.IO] Connection from non-whitelisted origin: ${origin}`);
            }
        },
        methods: ["GET", "POST", "PUT", "DELETE", "OPTIONS"],
        credentials: true,
        allowedHeaders: ["Content-Type", "Authorization", "X-Requested-With"]
    },
    allowEIO3: true,
    transports: ['websocket', 'polling']
});
```

**ä¼˜åŒ–ç‚¹**:
- âœ… ä¸ HTTP ä¸­é—´ä»¶ä¿æŒä¸€è‡´çš„ç™½åå•
- âœ… å¢åŠ å®‰å…¨å®¡è®¡æ—¥å¿—
- âœ… ä¿æŒå‘åå…¼å®¹æ€§ï¼ˆä»å…è®¸ä½†è­¦å‘Šï¼‰

##### C. ä¿®å¤æ„é€ å‡½æ•°å‚æ•°é¡ºåº
**æ–‡ä»¶**: `server/src/games/chinesechess/rooms/ChineseChessRoom.js`

**ä¿®æ”¹å‰**:
```javascript
class ChineseChessRoom extends BaseGameRoom {
    constructor(roomId, io, tier) {
        super(roomId, io); // âŒ é”™è¯¯çš„å‚æ•°é¡ºåº
        // ...
    }
}
```

**ä¿®æ”¹å**:
```javascript
class ChineseChessRoom extends BaseGameRoom {
    constructor(roomId, io, tier) {
        super(io, roomId); // âœ… æ­£ç¡®çš„å‚æ•°é¡ºåº
        // ...
    }
}
```

**è¯´æ˜**: `BaseGameRoom` æ„é€ å‡½æ•°ç­¾åä¸º `constructor(io, roomId)`ï¼Œå­ç±»å¿…é¡»éµå¾ªç›¸åŒé¡ºåºã€‚

#### éƒ¨ç½²æ­¥éª¤

1. **æäº¤ä»£ç åˆ° Git ä»“åº“**:
   ```bash
   git add .
   git commit -m "fix: CORSé…ç½®ä¼˜åŒ– + ä¿®å¤ChineseChessRoomæ„é€ å‡½æ•°"
   git push origin main
   ```

2. **Render è‡ªåŠ¨éƒ¨ç½²**:
   - Render æ£€æµ‹åˆ° Git æ¨é€åä¼šè‡ªåŠ¨è§¦å‘éƒ¨ç½²
   - éƒ¨ç½²æ—¶é—´çº¦ 2-5 åˆ†é’Ÿ

3. **éªŒè¯éƒ¨ç½²**:
   - è®¿é—® `https://happygames-tfdz.onrender.com/` ç¡®è®¤æœåŠ¡å™¨å·²å¯åŠ¨
   - æ£€æŸ¥æ—¥å¿—ä¸­æ˜¯å¦æœ‰ `Server running on port 5000` æ¶ˆæ¯

4. **æµ‹è¯•è¿æ¥**:
   - æ‰“å¼€ç”Ÿäº§ç¯å¢ƒ `https://www.happygames.online`
   - æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…· (F12) â†’ Network æ ‡ç­¾
   - æ£€æŸ¥æ˜¯å¦æœ‰ CORS é”™è¯¯
   - ç¡®è®¤ Socket.IO è¿æ¥çŠ¶æ€ä¸º `connected`

#### æ³¨æ„äº‹é¡¹

âš ï¸ **Render å…è´¹ç‰ˆé™åˆ¶**:
- æœåŠ¡å™¨åœ¨ 15 åˆ†é’Ÿæ— æ´»åŠ¨åä¼šè‡ªåŠ¨ä¼‘çœ 
- é¦–æ¬¡è¯·æ±‚éœ€è¦ 30-60 ç§’å”¤é†’æ—¶é—´
- å»ºè®®ä½¿ç”¨ UptimeRobot ç­‰æœåŠ¡å®šæœŸ ping ä¿æŒæ´»è·ƒ

âš ï¸ **CORS ç™½åå•ç»´æŠ¤**:
- æ–°å¢åŸŸåæ—¶éœ€åŒæ—¶æ›´æ–° `index.js` å’Œ `socket.js` ä¸¤å¤„é…ç½®
- æµ‹è¯•ç¯å¢ƒåŸŸåå»ºè®®ä½¿ç”¨ç¯å¢ƒå˜é‡ç®¡ç†

âš ï¸ **å®‰å…¨å»ºè®®**:
- ç”Ÿäº§ç¯å¢ƒåº”ç§»é™¤ `process.env.NODE_ENV === 'development'` çš„å®½æ¾åˆ¤æ–­
- è€ƒè™‘æ·»åŠ è¯·æ±‚é¢‘ç‡é™åˆ¶ (Rate Limiting)
- å®šæœŸå®¡æŸ¥ Socket.IO è¿æ¥æ—¥å¿—

---

### 13.2 å‰ç«¯ JSX è¯­æ³•é”™è¯¯ä¿®å¤ (2025-11-27)

#### é—®é¢˜æè¿°
TypeScript ç¼–è¯‘å™¨æŠ¥é”™ï¼š
```
';' expected. @[GameList.tsx:L220]
')' expected. @[GameList.tsx:L310]
Declaration or statement expected. @[GameList.tsx:L311]
```

#### æ ¹æœ¬åŸå› 
**æ–‡ä»¶**: `client/src/components/Lobby/GameList.tsx`

åœ¨ JSX çš„ `return` è¯­å¥ä¸­ï¼Œæ³¨é‡Šè¢«é”™è¯¯åœ°æ”¾ç½®åœ¨äº† JSX ç»“æ„ä¹‹å¤–ï¼š

```tsx
return (
    <div className="page-container">
        {/* ... */}
    </div>
    /* Page Container ç»“æŸ (End of Page Container) */  // âŒ é”™è¯¯ï¼šæ³¨é‡Šåœ¨ JSX å¤–éƒ¨
);
```

#### ä¿®å¤æ–¹æ¡ˆ
å°†æ³¨é‡Šç§»åŠ¨åˆ° JSX ç»“æ„å†…éƒ¨ï¼š

```tsx
return (
    <div className="page-container">
        {/* ... */}
        {/* Page Container ç»“æŸ (End of Page Container) */}  // âœ… æ­£ç¡®ï¼šæ³¨é‡Šåœ¨ JSX å†…éƒ¨
    </div>
);
```

#### ä¿®æ”¹è¯¦æƒ…
**è¡Œå·**: 306-312

**ä¿®æ”¹å‰**:
```tsx
            </div>
            {/* Grid ç»“æŸ (End of Grid) */}

        </div>
        /* Page Container ç»“æŸ (End of Page Container) */ }
    );
}
```

**ä¿®æ”¹å**:
```tsx
            </div>
            {/* Grid ç»“æŸ (End of Grid) */}

            {/* Page Container ç»“æŸ (End of Page Container) */}
        </div>
    );
}
```

#### JSX æ³¨é‡Šè§„èŒƒ
åœ¨ JSX ä¸­ä½¿ç”¨æ³¨é‡Šçš„æ­£ç¡®æ–¹å¼ï¼š

1. **JSX å†…éƒ¨æ³¨é‡Š** (æ¨è):
   ```tsx
   <div>
       {/* è¿™æ˜¯ä¸€ä¸ªæ³¨é‡Š */}
       <p>å†…å®¹</p>
   </div>
   ```

2. **å¤šè¡Œæ³¨é‡Š**:
   ```tsx
   <div>
       {/* 
           è¿™æ˜¯ä¸€ä¸ª
           å¤šè¡Œæ³¨é‡Š
       */}
       <p>å†…å®¹</p>
   </div>
   ```

3. **âŒ é”™è¯¯ç”¨æ³•**:
   ```tsx
   <div>
       <p>å†…å®¹</p>
   </div>
   // è¿™æ ·çš„æ³¨é‡Šä¼šå¯¼è‡´è¯­æ³•é”™è¯¯
   ```

#### éªŒè¯æ­¥éª¤
1. ä¿å­˜æ–‡ä»¶åï¼ŒTypeScript ç¼–è¯‘å™¨åº”ä¸å†æŠ¥é”™
2. è¿è¡Œ `npm run build` ç¡®è®¤æ„å»ºæˆåŠŸ
3. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°æ—  JavaScript é”™è¯¯

---

### 13.3 é—®é¢˜ä¿®å¤æ€»ç»“

| é—®é¢˜ç±»å‹ | å½±å“èŒƒå›´ | ä¸¥é‡ç¨‹åº¦ | ä¿®å¤æ–‡ä»¶ | çŠ¶æ€ |
|---------|---------|---------|---------|------|
| CORS è·¨åŸŸé˜»æ­¢ | ç”Ÿäº§ç¯å¢ƒå…¨éƒ¨åŠŸèƒ½ | ğŸ”´ ä¸¥é‡ | `server/src/index.js` | âœ… å·²ä¿®å¤ |
| Socket.IO CORS | å®æ—¶é€šä¿¡åŠŸèƒ½ | ğŸ”´ ä¸¥é‡ | `server/src/gamecore/socket.js` | âœ… å·²ä¿®å¤ |
| æ„é€ å‡½æ•°å‚æ•°é”™è¯¯ | ä¸­å›½è±¡æ£‹æ¸¸æˆ | ğŸŸ¡ ä¸­ç­‰ | `server/src/games/chinesechess/rooms/ChineseChessRoom.js` | âœ… å·²ä¿®å¤ |
| JSX è¯­æ³•é”™è¯¯ | æ¸¸æˆå¤§å…é¡µé¢ | ğŸŸ¡ ä¸­ç­‰ | `client/src/components/Lobby/GameList.tsx` | âœ… å·²ä¿®å¤ |

**ä¿®å¤æ—¥æœŸ**: 2025-11-27  
**ä¿®å¤äººå‘˜**: AI Assistant  
**æµ‹è¯•çŠ¶æ€**: å¾…éƒ¨ç½²éªŒè¯

---

## 14. æ¸¸æˆå¼€å‘æ¨¡æ¿ç³»ç»Ÿ (Game Development Template System)

### 14.1 æ¦‚è¿°

ä¸ºäº†æé«˜å¼€å‘æ•ˆç‡å’Œä¿è¯ä»£ç è´¨é‡ï¼Œæˆ‘ä»¬åŸºäºä¸­å›½è±¡æ£‹çš„æˆåŠŸå®ç°ï¼Œåˆ›å»ºäº†ä¸€å¥—å®Œæ•´çš„æ¸¸æˆå¼€å‘æ¨¡æ¿ç³»ç»Ÿã€‚æ‰€æœ‰æ–°æ¸¸æˆéƒ½åº”éµå¾ªæ­¤æ¨¡æ¿æ¶æ„ã€‚

### 14.2 æ¨¡æ¿ç‰¹æ€§

#### æ ¸å¿ƒä¼˜åŠ¿
- âœ… **å¿«é€Ÿå¼€å‘**: 1-2 å°æ—¶å®Œæˆæ–°æ¸¸æˆåŸºç¡€æ¶æ„
- âœ… **ä»£ç å¤ç”¨**: å‡å°‘ 70% çš„é‡å¤ä»£ç 
- âœ… **æ¶æ„ç»Ÿä¸€**: æ‰€æœ‰æ¸¸æˆä½¿ç”¨ç›¸åŒçš„é€šä¿¡æ¨¡å¼
- âœ… **é«˜å¯ç”¨æ€§**: å†…ç½® Socket.IO + HTTP åŒé€šé“å†—ä½™
- âœ… **æ˜“äºç»´æŠ¤**: æ¸…æ™°çš„ç›®å½•ç»“æ„å’Œå‘½åè§„èŒƒ

#### å…±äº«åŠŸèƒ½
æ‰€æœ‰ä½¿ç”¨æ¨¡æ¿åˆ›å»ºçš„æ¸¸æˆè‡ªåŠ¨è·å¾—ï¼š
- ğŸ¯ **åŒé€šé“å†—ä½™æœºåˆ¶**: Socket.IO + HTTP å¤‡ä»½
- ğŸ¯ **ELO ç­‰çº§åˆ†ç³»ç»Ÿ**: è‡ªåŠ¨è®¡ç®—å’Œæ›´æ–°
- ğŸ¯ **æ¸¸æˆè±†ç»“ç®—**: è‡ªåŠ¨å¤„ç†ä¸‹æ³¨å’Œå¥–åŠ±
- ğŸ¯ **æˆ¿é—´ç®¡ç†**: 4 ä¸ªç­‰çº§æˆ¿é—´ï¼ˆå…è´¹/åˆçº§/ä¸­çº§/é«˜çº§ï¼‰
- ğŸ¯ **å›½é™…åŒ–æ”¯æŒ**: 14 ç§è¯­è¨€
- ğŸ¯ **å®æ—¶é€šä¿¡**: Socket.IO äº‹ä»¶ç³»ç»Ÿ

### 14.3 æ¨¡æ¿ç»“æ„

#### æœåŠ¡ç«¯æ¨¡æ¿
```
server/src/games/{GAME_NAME}/
â”œâ”€â”€ index.js                    # æ¸¸æˆç®¡ç†å™¨
â”œâ”€â”€ logic/
â”‚   â””â”€â”€ {GameName}Rules.js     # æ¸¸æˆè§„åˆ™å¼•æ“
â””â”€â”€ rooms/
    â””â”€â”€ {GameName}Room.js      # æ¸¸æˆæˆ¿é—´é€»è¾‘
```

#### å®¢æˆ·ç«¯æ¨¡æ¿
```
client/src/
â”œâ”€â”€ components/{GameName}/
â”‚   â”œâ”€â”€ {GameName}Client.ts    # æ¸¸æˆå®¢æˆ·ç«¯é€»è¾‘
â”‚   â””â”€â”€ {GameName}Board.tsx    # æ¸¸æˆç•Œé¢ç»„ä»¶
â””â”€â”€ app/game/{GAME_NAME}/
    â”œâ”€â”€ page.tsx               # æ¸¸æˆä¸­å¿ƒ
    â””â”€â”€ play/page.tsx          # å¯¹å±€é¡µé¢
```

### 14.4 å¿«é€Ÿå¼€å§‹

#### åˆ›å»ºæ–°æ¸¸æˆï¼ˆä»¥äº”å­æ£‹ä¸ºä¾‹ï¼‰

**æ­¥éª¤ 1**: å¤åˆ¶æ¨¡æ¿æ–‡ä»¶
```bash
# æœåŠ¡ç«¯
cp -r server/src/games/_template server/src/games/gomoku

# å®¢æˆ·ç«¯
cp -r client/src/components/_GameTemplate client/src/components/Gomoku
cp -r client/src/app/game/_template client/src/app/game/gomoku
```

**æ­¥éª¤ 2**: æ›¿æ¢å ä½ç¬¦
- `{GAME_NAME}` â†’ `gomoku`
- `{GameName}` â†’ `Gomoku`
- `{æ¸¸æˆåç§°}` â†’ `äº”å­æ£‹`

**æ­¥éª¤ 3**: å®ç°æ¸¸æˆé€»è¾‘
- ä¿®æ”¹ `GomokuRules.js` å®ç°æ¸¸æˆè§„åˆ™
- ä¿®æ”¹ `GomokuBoard.tsx` å®ç°æ¸¸æˆç•Œé¢
- è°ƒæ•´æˆ¿é—´é…ç½®ï¼ˆå¦‚éœ€è¦ï¼‰

**æ­¥éª¤ 4**: æµ‹è¯•
- æœåŠ¡ç«¯è‡ªåŠ¨æ‰«æå¹¶åŠ è½½æ–°æ¸¸æˆ
- HTTP API è‡ªåŠ¨ç”Ÿæ•ˆ
- åŒé€šé“å†—ä½™è‡ªåŠ¨å·¥ä½œ

### 14.5 æ ¸å¿ƒç»„ä»¶è¯´æ˜

#### GameManagerï¼ˆæ¸¸æˆç®¡ç†å™¨ï¼‰
**èŒè´£**:
- ç®¡ç†æ‰€æœ‰æˆ¿é—´å®ä¾‹
- å¤„ç†ç©å®¶åŠ å…¥è¯·æ±‚
- éªŒè¯ç­‰çº§åˆ†æƒé™
- æä¾›æˆ¿é—´åˆ—è¡¨ API

**å…³é”®æ–¹æ³•**:
- `onPlayerJoin(socket, user)`: ç©å®¶åŠ å…¥æ¸¸æˆ
- `handleJoin(socket, data)`: å¤„ç†åŠ å…¥æˆ¿é—´
- `getRoomList(tier)`: è·å–æˆ¿é—´åˆ—è¡¨
- `canAccessTier(tier, rating)`: éªŒè¯ç­‰çº§åˆ†æƒé™

#### GameRoomï¼ˆæ¸¸æˆæˆ¿é—´ï¼‰
**èŒè´£**:
- ç®¡ç†å•ä¸ªæ¸¸æˆå¯¹å±€
- å¤„ç†æ¸¸æˆé€»è¾‘
- æ‰§è¡Œç»“ç®—æµç¨‹

**å…³é”®æ–¹æ³•**:
- `join(socket)`: ç©å®¶åŠ å…¥æˆ¿é—´
- `handleMove(socket, move)`: å¤„ç†ç©å®¶ç§»åŠ¨
- `endGame(winner)`: ç»“æŸæ¸¸æˆå¹¶ç»“ç®—
- `broadcastState()`: å¹¿æ’­æ¸¸æˆçŠ¶æ€

#### GameRulesï¼ˆæ¸¸æˆè§„åˆ™ï¼‰
**èŒè´£**:
- éªŒè¯ç§»åŠ¨åˆæ³•æ€§
- æ£€æŸ¥èƒœè´Ÿæ¡ä»¶
- å®ç°æ¸¸æˆç‰¹å®šè§„åˆ™

**å…³é”®æ–¹æ³•**:
- `isValidMove(board, move, player)`: éªŒè¯ç§»åŠ¨
- `checkWinner(board, lastMove)`: æ£€æŸ¥èƒœè´Ÿ

#### GameClientï¼ˆå®¢æˆ·ç«¯ï¼‰
**èŒè´£**:
- ç®¡ç† Socket é€šä¿¡
- å¤„ç†æ¸¸æˆçŠ¶æ€æ›´æ–°
- æä¾›æ¸¸æˆæ“ä½œæ¥å£

**å…³é”®æ–¹æ³•**:
- `init(onStateUpdate)`: åˆå§‹åŒ–å¹¶ç›‘å¬äº‹ä»¶
- `joinTier(tier)`: åŠ å…¥æŒ‡å®šç­‰çº§
- `makeMove(move)`: å‘é€ç§»åŠ¨æŒ‡ä»¤
- `dispose()`: æ¸…ç†èµ„æº

### 14.6 åŒé€šé“å†—ä½™æœºåˆ¶ (Communication Template)

æ‰€æœ‰æ¸¸æˆè‡ªåŠ¨å®ç°åŒé€šé“æ•°æ®è·å–ï¼Œè¯¦ç»†æŒ‡å—è¯·å‚è€ƒï¼š
ğŸ“„ **[COMMUNICATION_TEMPLATE_GUIDE.md](./COMMUNICATION_TEMPLATE_GUIDE.md)**

```typescript
// Socket.IO é€šé“ï¼ˆä¸»ï¼‰
socket.emit('get_rooms', { tier });
socket.on('room_list', (rooms) => setRooms(rooms));

// HTTP é€šé“ï¼ˆå¤‡ä»½ï¼‰
const res = await fetch(`${apiUrl}/api/games/{GAME_NAME}/rooms?tier=${tier}`);
const rooms = await res.json();
setRooms(rooms);

// æ¯ 5 ç§’è½®è¯¢ä¸¤ä¸ªé€šé“
setInterval(() => {
    fetchRoomsViaHttp();
    fetchRoomsViaSocket();
}, 5000);
```

**ä¼˜åŠ¿**:
- ğŸŸ¢ ä»»ä¸€é€šé“å¤±è´¥ä¸å½±å“åŠŸèƒ½
- ğŸŸ¢ Socket æä¾›å®æ—¶æ›´æ–°
- ğŸŸ¢ HTTP æä¾›æ›´å¥½çš„å…¼å®¹æ€§

### 14.7 å‘½åè§„èŒƒ

| ç±»å‹ | è§„èŒƒ | ç¤ºä¾‹ |
|------|------|------|
| æ¸¸æˆ ID | å°å†™ï¼Œä¸‹åˆ’çº¿åˆ†éš” | `chinese_chess`, `gomoku` |
| ç±»å | å¤§é©¼å³° | `ChineseChessManager`, `GomokuRoom` |
| äº‹ä»¶å | å°å†™ï¼Œæ¸¸æˆ ID å‰ç¼€ | `chinesechess_move`, `gomoku_join` |
| æ–‡ä»¶å | å¤§é©¼å³° | `ChineseChessClient.ts`, `GomokuBoard.tsx` |

### 14.8 å¼€å‘æ£€æŸ¥æ¸…å•

åˆ›å»ºæ–°æ¸¸æˆæ—¶ï¼Œè¯·ç¡®ä¿å®Œæˆï¼š

**æœåŠ¡ç«¯**:
- [ ] åˆ›å»º `{GameName}Manager` ç±»
- [ ] åˆ›å»º `{GameName}Room` ç±»
- [ ] åˆ›å»º `{GameName}Rules` ç±»
- [ ] å®ç°æ¸¸æˆè§„åˆ™éªŒè¯é€»è¾‘
- [ ] å®ç°èƒœè´Ÿåˆ¤å®šé€»è¾‘
- [ ] é…ç½®æˆ¿é—´ç­‰çº§å’Œåº•è±†

**å®¢æˆ·ç«¯**:
- [ ] åˆ›å»º `{GameName}Client` ç±»
- [ ] åˆ›å»º `{GameName}Board` ç»„ä»¶
- [ ] åˆ›å»ºæ¸¸æˆä¸­å¿ƒé¡µé¢
- [ ] åˆ›å»ºå¯¹å±€é¡µé¢
- [ ] å®ç°åŒé€šé“æˆ¿é—´åˆ—è¡¨è·å–
- [ ] å®ç°æ¸¸æˆç•Œé¢æ¸²æŸ“

**å…¶ä»–**:
- [ ] æ·»åŠ å›½é™…åŒ–ç¿»è¯‘é”®å€¼
- [ ] æµ‹è¯• Socket.IO è¿æ¥
- [ ] æµ‹è¯• HTTP API
- [ ] æµ‹è¯•åŒé€šé“å†—ä½™
- [ ] æµ‹è¯• ELO ç»“ç®—
- [ ] æµ‹è¯•æ¸¸æˆè±†ç»“ç®—
- [ ] æ›´æ–°å¼€å‘æ–‡æ¡£

### 14.9 è¯¦ç»†æ–‡æ¡£

å®Œæ•´çš„æ¨¡æ¿ä»£ç å’Œä½¿ç”¨è¯´æ˜è¯·å‚è€ƒï¼š
ğŸ“„ **[GAME_TEMPLATE_GUIDE.md](./GAME_TEMPLATE_GUIDE.md)**

è¯¥æ–‡æ¡£åŒ…å«ï¼š
- å®Œæ•´çš„æœåŠ¡ç«¯æ¨¡æ¿ä»£ç 
- å®Œæ•´çš„å®¢æˆ·ç«¯æ¨¡æ¿ä»£ç 
- è¯¦ç»†çš„ä½¿ç”¨è¯´æ˜
- æœ€ä½³å®è·µæŒ‡å—
- å®Œæ•´çš„äº”å­æ£‹ç¤ºä¾‹

### 14.10 æ¨¡æ¿ä¼˜åŠ¿æ€»ç»“

ä½¿ç”¨æ¨¡æ¿ç³»ç»Ÿå¼€å‘æ–°æ¸¸æˆï¼š

| ä¼ ç»Ÿæ–¹å¼ | ä½¿ç”¨æ¨¡æ¿ | æå‡ |
|---------|---------|------|
| 8-10 å°æ—¶ | 1-2 å°æ—¶ | **80% â¬‡ï¸** |
| éœ€è¦ç†è§£æ‰€æœ‰æ¶æ„ | åªéœ€å…³æ³¨æ¸¸æˆé€»è¾‘ | **ä¸“æ³¨åº¦ â¬†ï¸** |
| å®¹æ˜“å‡ºç°æ¶æ„ä¸ä¸€è‡´ | å¼ºåˆ¶ç»Ÿä¸€æ¶æ„ | **è´¨é‡ â¬†ï¸** |
| éœ€è¦æ‰‹åŠ¨å®ç°å†—ä½™ | è‡ªåŠ¨è·å¾—åŒé€šé“ | **å¯é æ€§ â¬†ï¸** |
| éœ€è¦æ‰‹åŠ¨é›†æˆ ELO | è‡ªåŠ¨é›†æˆ | **åŠŸèƒ½å®Œæ•´æ€§ â¬†ï¸** |

**ç»“è®º**: ä½¿ç”¨æ¨¡æ¿ç³»ç»Ÿå¯ä»¥å°†æ–°æ¸¸æˆå¼€å‘æ—¶é—´ä» **8-10 å°æ—¶** ç¼©çŸ­åˆ° **1-2 å°æ—¶**ï¼ŒåŒæ—¶ä¿è¯ä»£ç è´¨é‡å’Œæ¶æ„ä¸€è‡´æ€§ã€‚

---

## 15. UI æ¨¡æ¿ç³»ç»Ÿ (UI Template System)

ä¸ºäº†ç»Ÿä¸€æ¸¸æˆè§†è§‰é£æ ¼å¹¶å‡å°‘é‡å¤å¼€å‘ï¼Œæˆ‘ä»¬æä¾›äº†ä¸€å¥—æ ‡å‡†åŒ–çš„ UI ç»„ä»¶æ¨¡æ¿ã€‚

è¯¦ç»†æŒ‡å—è¯·å‚è€ƒï¼š
ğŸ“„ **[UI_TEMPLATE_GUIDE.md](./UI_TEMPLATE_GUIDE.md)**

### 15.1 æ ¸å¿ƒç»„ä»¶

1.  **GameTierSelector (ç­‰çº§é€‰æ‹©å™¨)**
    -   **åŠŸèƒ½**: å±•ç¤ºæ¸¸æˆç­‰çº§æˆ¿é—´ï¼ˆå…è´¹/åˆçº§/ä¸­çº§/é«˜çº§ï¼‰ï¼ŒåŒ…å«å…¥åœºè´¹ã€åº•è±†è¯´æ˜ã€‚
    -   **ç‰¹æ€§**: è‡ªåŠ¨é›†æˆç”¨æˆ·ä½™é¢æ£€æŸ¥ã€ç­‰çº§åˆ†æƒé™éªŒè¯ã€‚
    -   **ä½¿ç”¨**: `client/src/app/game/{game}/page.tsx`

2.  **GameRoomList (æˆ¿é—´åˆ—è¡¨)**
    -   **åŠŸèƒ½**: å±•ç¤ºå½“å‰ç­‰çº§ä¸‹çš„æ‰€æœ‰æˆ¿é—´ï¼Œæ”¯æŒå¿«é€Ÿå¼€å§‹ã€æˆ¿é—´ç­›é€‰ã€‚
    -   **ç‰¹æ€§**: è‡ªåŠ¨é›†æˆåŒé€šé“æ•°æ®è·å– (`useRoomList` Hook)ã€‚
    -   **ä½¿ç”¨**: `client/src/app/game/{game}/play/page.tsx` (å¤§å…æ¨¡å¼)

3.  **GamePlayLayout (å¯¹å±€å¸ƒå±€)**
    -   **åŠŸèƒ½**: æ ‡å‡†åŒ–çš„æ¸¸æˆå¯¹å±€ç•Œé¢å¸ƒå±€ã€‚
    -   **åŒ…å«**: é¡¶éƒ¨çŠ¶æ€æ ï¼ˆç©å®¶ä¿¡æ¯ã€å€’è®¡æ—¶ï¼‰ã€ä¸­å¤®æ¸¸æˆåŒºã€åº•éƒ¨æ“ä½œæ ã€‚
    -   **ä½¿ç”¨**: `client/src/app/game/{game}/play/page.tsx` (æ¸¸æˆæ¨¡å¼)

4.  **MatchSettingsPanel (åŒ¹é…è®¾ç½®é¢æ¿)**
    -   **åŠŸèƒ½**: è‡ªåŠ¨åŒ¹é…çš„æ¡ä»¶è®¾ç½®ç•Œé¢ã€‚
    -   **åŒ…å«**: åº•è±†èŒƒå›´ã€èƒœç‡ç­›é€‰ã€æ‰çº¿ç‡é™åˆ¶ã€ç­‰çº§åˆ†ç­›é€‰ã€‚

---

## 16. æ¸¸æˆåŒ¹é…ç³»ç»Ÿ (Game Matching System)

å®Œæ•´çš„ç©å®¶åŒ¹é…è§£å†³æ–¹æ¡ˆï¼Œæ”¯æŒè‡ªåŠ¨åŒ¹é…å’Œæ‰‹åŠ¨å…¥åº§ã€‚

è¯¦ç»†æŒ‡å—è¯·å‚è€ƒï¼š
ğŸ“„ **[MATCH_SYSTEM_GUIDE.md](./MATCH_SYSTEM_GUIDE.md)**

### 16.1 æ ¸å¿ƒç‰¹æ€§

-   âœ… **è‡ªåŠ¨åŒ¹é…**: åŸºäºé˜Ÿåˆ—çš„æ™ºèƒ½åŒ¹é…
-   âœ… **æ‰‹åŠ¨å…¥åº§**: ä¼ ç»Ÿçš„å¤§å…æˆ¿é—´æ¨¡å¼
-   âœ… **æ¡ä»¶ç­›é€‰**: åº•è±†ã€èƒœç‡ã€æ‰çº¿ç‡ã€ç­‰çº§åˆ†
-   âœ… **é˜²ä½œå¼Š**: åƒµå°¸æ¡Œæ¸…ç†ã€æ—è§‚é™åˆ¶
-   âœ… **æ‰çº¿ç»Ÿè®¡**: è‡ªåŠ¨è®°å½•å’Œè®¡ç®—ç©å®¶æ‰çº¿ç‡

### 16.2 æ¶æ„é›†æˆ

-   **æœåŠ¡ç«¯**: `MatchableGameRoom` (åŸºç±»), `AutoMatchManager` (æœåŠ¡)
-   **å®¢æˆ·ç«¯**: `MatchSettingsPanel` (UI), `socket` äº‹ä»¶å¤„ç†

---

