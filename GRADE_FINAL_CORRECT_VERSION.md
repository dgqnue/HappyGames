# Grade ç®—æ³•ä¿®å¤ - æœ€ç»ˆç‰ˆæœ¬ï¼ˆæ­£ç¡®é€»è¾‘ï¼‰

## âœ… é—®é¢˜å·²è§£å†³

**æ‚¨çš„è§„åˆ™ç†è§£æ­£ç¡®**ï¼š
- ç¬¬1åçŽ©å®¶ï¼šç‹¬å "ä¸¾ä¸–æ— åŒ"ï¼Œ**ä¸å‚ä¸Žç™¾åˆ†æ¯”åˆ†é…**
- å‰©ä½™ N-1 ä¸ªçŽ©å®¶ï¼šæŒ‰ç…§ç™¾åˆ†æ¯”åˆ†é…å…¶ä»–9ä¸ªç­‰çº§

---

## ðŸ”§ æ–°ç®—æ³•æ ¸å¿ƒé€»è¾‘

```javascript
getTitleByRank(rank, totalPlayers) {
    // ç¬¬1åï¼šç›´æŽ¥è¿”å›ž "ä¸¾ä¸–æ— åŒ"
    if (rank === 1) {
        return TITLES[9];  // ä¸¾ä¸–æ— åŒ
    }
    
    // å‰©ä½™çŽ©å®¶åœ¨ N-1 ä¸ªçŽ©å®¶ä¸­çš„ç›¸å¯¹æŽ’å
    const remainingRank = rank - 1;
    const remainingPlayers = totalPlayers - 1;
    
    // åªå¯¹å‰©ä½™çŽ©å®¶è¿›è¡Œç™¾åˆ†æ¯”åˆ†é…
    // æŒ‰ç™¾åˆ†æ¯”ä»Žå‰©ä½™çŽ©å®¶ä¸­åˆ†é…å…¶ä»–9ä¸ªç­‰çº§
}
```

---

## ðŸ“Š éªŒè¯ï¼š2ä¸ªçŽ©å®¶

### è®¡ç®—è¿‡ç¨‹

```
totalPlayers = 2

1. rank = 1
   - rank === 1? âœ… YES
   - è¿”å›ž TITLES[9] = ä¸¾ä¸–æ— åŒ âœ“

2. rank = 2
   - rank === 1? NO
   - remainingRank = 2 - 1 = 1ï¼ˆåœ¨å‰©ä½™1ä¸ªçŽ©å®¶ä¸­æŽ’åç¬¬1ï¼‰
   - remainingPlayers = 2 - 1 = 1
   
   - ç™»å³°é€ æžï¼šplayerCount = max(1, ceil(1 * 0.02)) = max(1, ceil(0.02)) = max(1, 1) = 1
   - èŒƒå›´ï¼š[1, 1]
   - 1 >= 1 && 1 <= 1? âœ… YES
   - è¿”å›ž TITLES[8] = ç™»å³°é€ æž âœ“
```

### ç»“æžœ

| æŽ’å | çŽ©å®¶ | è®¡ç®— | å¾—åˆ°ç§°å· | âœ… æ­£ç¡® |
|------|------|------|----------|---------|
| 1 | A | ç¬¬1åç‰¹æ®Šå¤„ç† | ä¸¾ä¸–æ— åŒ | âœ… |
| 2 | B | å‰©ä½™1äººä¸­æŽ’åç¬¬1 | ç™»å³°é€ æž | âœ… |

---

## ðŸ“Š éªŒè¯ï¼š100ä¸ªçŽ©å®¶

### è®¡ç®—è¿‡ç¨‹

```
totalPlayers = 100

1. rank = 1
   - rank === 1? âœ… YES
   - è¿”å›ž ä¸¾ä¸–æ— åŒ âœ“

2. rank = 2 åˆ° rank = 100
   - éƒ½è¿›å…¥ç¬¬äºŒé˜¶æ®µ
   - remainingPlayers = 100 - 1 = 99
   - åœ¨è¿™99ä¸ªçŽ©å®¶ä¸­æŒ‰æ¯”ä¾‹åˆ†é…

ç­‰çº§åˆ†é…ï¼ˆåœ¨99ä¸ªçŽ©å®¶ä¸­ï¼‰ï¼š
- ç™»å³°é€ æžï¼ˆtop 2%ï¼‰ï¼šmax(1, ceil(99 * 0.02)) = max(1, 2) = 2 äºº      â†’ rank 1-2 (ç»å¯¹ 2-3)
- å‚²è§†ç¾¤é›„ï¼ˆtop 4%ï¼‰ï¼šmax(1, ceil(99 * 0.04)) = max(1, 4) = 4 äºº      â†’ rank 3-6 (ç»å¯¹ 4-7)
- åæ»¡æ±Ÿæ¹–ï¼ˆtop 6%ï¼‰ï¼šmax(1, ceil(99 * 0.06)) = max(1, 6) = 6 äºº      â†’ rank 7-12 (ç»å¯¹ 8-13)
- ç‚‰ç«çº¯é’ï¼ˆtop 8%ï¼‰ï¼šmax(1, ceil(99 * 0.08)) = max(1, 8) = 8 äºº      â†’ rank 13-20 (ç»å¯¹ 14-21)
- å‡ºç±»æ‹”èƒï¼ˆtop 10%ï¼‰ï¼šmax(1, ceil(99 * 0.10)) = max(1, 10) = 10 äºº   â†’ rank 21-30 (ç»å¯¹ 22-31)
- é”‹èŠ’æ¯•éœ²ï¼ˆtop 13%ï¼‰ï¼šmax(1, ceil(99 * 0.13)) = max(1, 13) = 13 äºº   â†’ rank 31-43 (ç»å¯¹ 32-44)
- æ¸å…¥ä½³å¢ƒï¼ˆtop 16%ï¼‰ï¼šmax(1, ceil(99 * 0.16)) = max(1, 16) = 16 äºº   â†’ rank 44-59 (ç»å¯¹ 45-60)
- å°è¯•ç‰›åˆ€ï¼ˆtop 19%ï¼‰ï¼šmax(1, ceil(99 * 0.19)) = max(1, 19) = 19 äºº   â†’ rank 60-78 (ç»å¯¹ 61-79)
- åˆå‡ºèŒ…åºï¼ˆå‰©ä½™ï¼‰ï¼š99 - (2+4+6+8+10+13+16+19) = 21 äºº â†’ rank 79-99 (ç»å¯¹ 80-100)

éªŒè¯ï¼š1 + 2 + 4 + 6 + 8 + 10 + 13 + 16 + 19 + 21 = 100 âœ“
```

### ç§°å·åˆ†å¸ƒ

| ç»å¯¹æŽ’å | ç§°å· | äººæ•° | å æ¯” |
|----------|------|------|------|
| 1 | ä¸¾ä¸–æ— åŒ | 1 | 1% |
| 2-3 | ç™»å³°é€ æž | 2 | 2% |
| 4-7 | å‚²è§†ç¾¤é›„ | 4 | 4% |
| 8-13 | åæ»¡æ±Ÿæ¹– | 6 | 6% |
| 14-21 | ç‚‰ç«çº¯é’ | 8 | 8% |
| 22-31 | å‡ºç±»æ‹”èƒ | 10 | 10% |
| 32-44 | é”‹èŠ’æ¯•éœ² | 13 | 13% |
| 45-60 | æ¸å…¥ä½³å¢ƒ | 16 | 16% |
| 61-79 | å°è¯•ç‰›åˆ€ | 19 | 19% |
| 80-100 | åˆå‡ºèŒ…åº | 21 | 21% |

**éªŒè¯ç™¾åˆ†æ¯”æ€»å’Œ**ï¼š1 + 2 + 4 + 6 + 8 + 10 + 13 + 16 + 19 + 21 = 100% âœ“

---

## ðŸ“Š éªŒè¯ï¼š10ä¸ªçŽ©å®¶

### è®¡ç®—è¿‡ç¨‹

```
totalPlayers = 10
remainingPlayers = 9

ç­‰çº§åˆ†é…ï¼ˆåœ¨9ä¸ªçŽ©å®¶ä¸­ï¼‰ï¼š
- ç™»å³°é€ æžï¼ˆtop 2%ï¼‰ï¼šmax(1, ceil(9 * 0.02)) = max(1, 1) = 1 äºº
- å‚²è§†ç¾¤é›„ï¼ˆtop 4%ï¼‰ï¼šmax(1, ceil(9 * 0.04)) = max(1, 1) = 1 äºº
- åæ»¡æ±Ÿæ¹–ï¼ˆtop 6%ï¼‰ï¼šmax(1, ceil(9 * 0.06)) = max(1, 1) = 1 äºº
- ç‚‰ç«çº¯é’ï¼ˆtop 8%ï¼‰ï¼šmax(1, ceil(9 * 0.08)) = max(1, 1) = 1 äºº
- å‡ºç±»æ‹”èƒï¼ˆtop 10%ï¼‰ï¼šmax(1, ceil(9 * 0.10)) = max(1, 1) = 1 äºº
- é”‹èŠ’æ¯•éœ²ï¼ˆtop 13%ï¼‰ï¼šmax(1, ceil(9 * 0.13)) = max(1, 2) = 2 äºº
- æ¸å…¥ä½³å¢ƒï¼ˆtop 16%ï¼‰ï¼šmax(1, ceil(9 * 0.16)) = max(1, 1) = 1 äºº
- å°è¯•ç‰›åˆ€ï¼ˆtop 19%ï¼‰ï¼šmax(1, ceil(9 * 0.19)) = max(1, 2) = 2 äºº
- åˆå‡ºèŒ…åºï¼ˆå‰©ä½™ï¼‰ï¼š9 - (1+1+1+1+1+2+1+2) = 0 äºº
```

### ç§°å·åˆ†å¸ƒ

| ç»å¯¹æŽ’å | ç§°å· | äººæ•° |
|----------|------|------|
| 1 | ä¸¾ä¸–æ— åŒ | 1 |
| 2 | ç™»å³°é€ æž | 1 |
| 3 | å‚²è§†ç¾¤é›„ | 1 |
| 4 | åæ»¡æ±Ÿæ¹– | 1 |
| 5 | ç‚‰ç«çº¯é’ | 1 |
| 6 | å‡ºç±»æ‹”èƒ | 1 |
| 7-8 | é”‹èŠ’æ¯•éœ² | 2 |
| 9 | æ¸å…¥ä½³å¢ƒ | 1 |
| 10 | å°è¯•ç‰›åˆ€ | 1 |

**æ³¨æ„**ï¼šåˆå‡ºèŒ…åº (0äºº) åœ¨10äººåœºæ™¯ä¸­æ— äººèŽ·å¾—

---

## ðŸŽ¯ æ ¸å¿ƒæ”¹å˜

### ä¹‹å‰ï¼ˆé”™è¯¯ï¼‰
```javascript
getTitleByRank(rank, totalPlayers) {
    // å¯¹æ‰€æœ‰çŽ©å®¶ï¼ˆåŒ…æ‹¬ç¬¬1åï¼‰è®¡ç®—ç™¾åˆ†æ¯”
    const percentile = rank / totalPlayers;
    
    // ä¼šå¯¼è‡´ï¼šrank=2, total=2
    // percentile = 2/2 = 1.0 (100%)
    // æ— æ³•åŒ¹é…ä»»ä½•ç­‰çº§ â†’ è¿”å›ž åˆå‡ºèŒ…åº âŒ
}
```

### çŽ°åœ¨ï¼ˆæ­£ç¡®ï¼‰
```javascript
getTitleByRank(rank, totalPlayers) {
    // ç¬¬1åç‰¹æ®Šå¤„ç†
    if (rank === 1) {
        return TITLES[9];  // ä¸¾ä¸–æ— åŒ
    }
    
    // å‰©ä½™çŽ©å®¶è¿›è¡Œç›¸å¯¹ç™¾åˆ†æ¯”åˆ†é…
    const remainingRank = rank - 1;
    const remainingPlayers = totalPlayers - 1;
    
    // åœ¨ N-1 ä¸ªçŽ©å®¶ä¸­è®¡ç®—ç™¾åˆ†æ¯”
    // rank=2, total=2 â†’ remainingRank=1, remainingPlayers=1
    // â†’ åœ¨1ä¸ªçŽ©å®¶ä¸­æŽ’åç¬¬1
    // â†’ ç™»å³°é€ æžï¼ˆtop 2%ä¸­çš„ç¬¬1åï¼‰âœ“
}
```

---

## âœ… ä»£ç çŠ¶æ€

- âœ… æ–°ç®—æ³•å·²å®žçŽ°
- âœ… ä»£ç é€šè¿‡è¯­æ³•æ£€æŸ¥
- âœ… æ—¥å¿—è¾“å‡ºå·²æ·»åŠ ç”¨äºŽè°ƒè¯•

### é¢„æœŸæ—¥å¿—è¾“å‡ºï¼ˆ2ä¸ªçŽ©å®¶ï¼‰

```
[GRADE] getTitleByRank: rank=1, total=2
  âœ“ matched ä¸¾ä¸–æ— åŒ (rank 1)

[GRADE] getTitleByRank: rank=2, total=2
  checking ç™»å³°é€ æž: remaining rank in [1, 1]? count=1
  âœ“ matched ç™»å³°é€ æž
```

---

## ðŸ“ ä¸‹ä¸€æ­¥

1. **æµ‹è¯•éªŒè¯**ï¼šè¿è¡Œæ¸¸æˆï¼ŒéªŒè¯2ä¸ªçŽ©å®¶çš„æƒ…å†µ
   - çŽ©å®¶Aï¼ˆrank 1ï¼‰ï¼šåº”è¯¥çœ‹åˆ° "ä¸¾ä¸–æ— åŒ" âœ“
   - çŽ©å®¶Bï¼ˆrank 2ï¼‰ï¼šåº”è¯¥çœ‹åˆ° "ç™»å³°é€ æž" âœ“

2. **æ£€æŸ¥æ—¥å¿—**ï¼šæŸ¥çœ‹æŽ§åˆ¶å°è¾“å‡ºçš„æ—¥å¿—ç¡®è®¤ç®—æ³•æ‰§è¡Œ

3. **æ‰©å±•æµ‹è¯•**ï¼šç”¨10ä¸ªã€100ä¸ªçŽ©å®¶éªŒè¯

4. **æ•°æ®æ›´æ–°**ï¼šå¦‚éœ€è¦ï¼Œè¿è¡Œ `Grade.updateAllPlayerTitles('chinesechess')` é‡æ–°è®¡ç®—æ‰€æœ‰çŽ©å®¶ç§°å·

