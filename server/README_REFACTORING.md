# HappyGames æœåŠ¡ç«¯é‡æ„æ–‡æ¡£

æ¬¢è¿æŸ¥é˜… HappyGames æœåŠ¡ç«¯ä»£ç é‡æ„æ–‡æ¡£ã€‚æœ¬æ¬¡é‡æ„å°†ä»£ç æŒ‰ç…§èŒè´£è¿›è¡Œäº†å½»åº•è§£è€¦ï¼Œä½¿å…¶æ›´æ˜“äºç†è§£ã€ç»´æŠ¤å’Œæ‰©å±•ã€‚

---

## ğŸ“š æ–‡æ¡£å¯¼èˆª

### æ–°æ‰‹å…¥é—¨
1. **[å¿«é€Ÿå‚è€ƒæŒ‡å—](QUICK_REFERENCE.md)** â­ æ¨èé¦–å…ˆé˜…è¯»
   - å¸¸è§ä»»åŠ¡çš„å¿«é€ŸæŸ¥æ‰¾
   - ä»£ç ç‰‡æ®µ
   - æœ€ä½³å®è·µ

2. **[æ¶æ„è¯´æ˜](ARCHITECTURE.md)**
   - ç³»ç»Ÿæ¶æ„æ€»è§ˆ
   - æ¨¡å—èŒè´£åˆ’åˆ†
   - æ•°æ®æµè¯´æ˜

### æ·±å…¥ç†è§£
3. **[æ¨¡å—ç´¢å¼•](MODULE_INDEX.md)**
   - æ‰€æœ‰æ¨¡å—çš„è¯¦ç»†è¯´æ˜
   - æ¨¡å—ä¾èµ–å…³ç³»
   - Socket äº‹ä»¶åˆ—è¡¨
   - æ•°æ®æ¨¡å‹å®šä¹‰

4. **[è¿ç§»æŒ‡å—](MIGRATION_GUIDE.md)**
   - æ–°æ—§æ¶æ„å¯¹æ¯”
   - è¿ç§»æ­¥éª¤
   - å¸¸è§é—®é¢˜è§£ç­”

### é¡¹ç›®æ€»ç»“
5. **[é‡æ„å®Œæˆæ€»ç»“](REFACTORING_SUMMARY.md)**
   - å®Œæˆçš„å·¥ä½œæ¸…å•
   - æ–‡ä»¶ç»Ÿè®¡
   - åç»­å·¥ä½œå»ºè®®

---

## ğŸ—ï¸ æ–°æ¶æ„æ¦‚è§ˆ

### æ ¸å¿ƒæ¨¡å—

```
server/src/core/
â”œâ”€â”€ network/          # ç½‘ç»œé€šä¿¡æ¨¡å—
â”‚   â”œâ”€â”€ SocketServer.js
â”‚   â””â”€â”€ HttpService.js
â”œâ”€â”€ matching/         # åŒ¹é…ç³»ç»Ÿæ¨¡å—
â”‚   â””â”€â”€ MatchMaker.js
â”œâ”€â”€ hierarchy/        # æ¸¸æˆå±‚çº§æ¨¡å—
â”‚   â”œâ”€â”€ GameManager.js
â”‚   â”œâ”€â”€ GameTier.js
â”‚   â””â”€â”€ GameTable.js
â””â”€â”€ game/            # æ¸¸æˆåŠ è½½æ¨¡å—
    â””â”€â”€ GameLoader.js
```

### æ¨¡å—èŒè´£

| æ¨¡å— | èŒè´£ |
|------|------|
| **SocketServer** | Socket.IO è¿æ¥ç®¡ç†ã€é‰´æƒã€äº‹ä»¶åˆ†å‘ |
| **HttpService** | HTTP API æœåŠ¡ã€æˆ¿é—´åˆ—è¡¨æŸ¥è¯¢ |
| **MatchMaker** | åŒ¹é…é˜Ÿåˆ—ç®¡ç†ã€åŒ¹é…ç®—æ³•æ‰§è¡Œ |
| **GameManager** | æ¸¸æˆæ€»ç®¡ç†å™¨ã€åè°ƒæ¸¸æˆå®¤å’Œæ¸¸æˆæ¡Œ |
| **GameTier** | æ¸¸æˆå®¤ç®¡ç†ã€ç­‰çº§åˆ†å‡†å…¥æ§åˆ¶ |
| **GameTable** | æ¸¸æˆæ¡ŒåŸºç±»ã€å¯¹å±€çŠ¶æ€ç®¡ç† |
| **GameLoader** | åŠ¨æ€åŠ è½½æ¸¸æˆã€ç»Ÿä¸€ç®¡ç† |

---

## ğŸ® æ¸¸æˆå±‚çº§ç»“æ„

```
GameManager (æ¸¸æˆç®¡ç†å™¨)
    â”‚
    â”œâ”€â†’ GameTier: free (å…è±†å®¤)
    â”‚       â”œâ”€â†’ GameTable 0
    â”‚       â”œâ”€â†’ GameTable 1
    â”‚       â””â”€â†’ GameTable 2
    â”‚
    â”œâ”€â†’ GameTier: beginner (åˆçº§å®¤)
    â”‚       â”œâ”€â†’ GameTable 0
    â”‚       â””â”€â†’ ...
    â”‚
    â”œâ”€â†’ GameTier: intermediate (ä¸­çº§å®¤)
    â”‚       â””â”€â†’ ...
    â”‚
    â””â”€â†’ GameTier: advanced (é«˜çº§å®¤)
            â””â”€â†’ ...
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ·»åŠ æ–°æ¸¸æˆï¼ˆ3 æ­¥ï¼‰

1. **åˆ›å»ºæ¸¸æˆç®¡ç†å™¨**
```javascript
// games/mygame/MyGameManager.js
const GameManager = require('../../core/hierarchy/GameManager');
const MyGameTable = require('./rooms/MyGameTable');

class MyGameManager extends GameManager {
    constructor(io, matchMaker) {
        super(io, 'mygame', MyGameTable, matchMaker);
    }
}

module.exports = MyGameManager;
```

2. **åˆ›å»ºæ¸¸æˆæ¡Œ**
```javascript
// games/mygame/rooms/MyGameTable.js
const GameTable = require('../../../core/hierarchy/GameTable');

class MyGameTable extends GameTable {
    constructor(io, tableId, tier) {
        super(io, tableId, 'mygame', 2, tier);
    }
    
    onGameStart() { /* æ¸¸æˆå¼€å§‹é€»è¾‘ */ }
    onGameEnd(result) { /* æ¸¸æˆç»“æŸé€»è¾‘ */ }
    onPlayerDisconnectDuringGame(userId) { /* æ–­çº¿å¤„ç† */ }
}

module.exports = MyGameTable;
```

3. **é‡å¯æœåŠ¡å™¨**
   - æ¸¸æˆä¼šè‡ªåŠ¨åŠ è½½ï¼Œæ— éœ€ä¿®æ”¹å…¶ä»–æ–‡ä»¶ï¼

---

## ğŸ“Š æ•°æ®æµç¤ºä¾‹

### ç©å®¶æ‰‹åŠ¨åŠ å…¥æ¸¸æˆæ¡Œ

```
å®¢æˆ·ç«¯                SocketServer         GameManager          GameTier            GameTable
  â”‚                       â”‚                    â”‚                    â”‚                   â”‚
  â”‚â”€â”€ start_game â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚                    â”‚                    â”‚                   â”‚
  â”‚                       â”‚â”€â”€ onPlayerJoin â”€â”€â”€â†’â”‚                    â”‚                   â”‚
  â”‚                       â”‚                    â”‚                    â”‚                   â”‚
  â”‚â”€â”€ get_rooms â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚                    â”‚                    â”‚                   â”‚
  â”‚                       â”‚â”€â”€ handleGetRooms â”€â†’â”‚                    â”‚                   â”‚
  â”‚                       â”‚                    â”‚â”€â”€ getTableList â”€â”€â”€â†’â”‚                   â”‚
  â”‚â†â”€â”€ room_list â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                    â”‚                    â”‚                   â”‚
  â”‚                       â”‚                    â”‚                    â”‚                   â”‚
  â”‚â”€â”€ xxx_join â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚                    â”‚                    â”‚                   â”‚
  â”‚                       â”‚â”€â”€ handleJoinTable â”€â†’â”‚                    â”‚                   â”‚
  â”‚                       â”‚                    â”‚â”€â”€ findTable â”€â”€â”€â”€â”€â”€â†’â”‚                   â”‚
  â”‚                       â”‚                    â”‚â”€â”€ join â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚
  â”‚â†â”€â”€ player_joined â”€â”€â”€â”€â”€â”‚                    â”‚                    â”‚                   â”‚
```

### ç©å®¶è‡ªåŠ¨åŒ¹é…

```
å®¢æˆ·ç«¯                GameManager          MatchMaker           GameTable
  â”‚                       â”‚                    â”‚                   â”‚
  â”‚â”€â”€ auto_match â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚                    â”‚                   â”‚
  â”‚                       â”‚â”€â”€ joinQueue â”€â”€â”€â”€â”€â”€â†’â”‚                   â”‚
  â”‚â†â”€â”€ match_queue_joined â”€â”‚                    â”‚                   â”‚
  â”‚                       â”‚                    â”‚ (å®šæ—¶æ£€æŸ¥)         â”‚
  â”‚                       â”‚â†â”€â”€ handleMatchFound â”€â”‚                   â”‚
  â”‚                       â”‚â”€â”€ join â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚
  â”‚â†â”€â”€ match_found â”€â”€â”€â”€â”€â”€â”€â”‚                    â”‚                   â”‚
  â”‚                       â”‚â”€â”€ playerReady â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚
  â”‚â†â”€â”€ game_start â”€â”€â”€â”€â”€â”€â”€â”€â”‚                    â”‚                   â”‚
```

---

## ğŸ”‘ æ ¸å¿ƒæ¦‚å¿µ

### æ¸¸æˆå®¤ (GameTier)
- æŒ‰ç­‰çº§åˆ†åˆ†ç±»çš„æ¸¸æˆåŒºåŸŸ
- ä¾‹å¦‚ï¼šå…è±†å®¤ã€åˆçº§å®¤ã€ä¸­çº§å®¤ã€é«˜çº§å®¤
- æ¯ä¸ªæ¸¸æˆå®¤åŒ…å«å¤šä¸ªæ¸¸æˆæ¡Œ

### æ¸¸æˆæ¡Œ (GameTable)
- å…·ä½“çš„æ¸¸æˆå¯¹å±€å®ä¾‹
- ç©å®¶åœ¨æ¡Œä¸Šè¿›è¡Œæ¸¸æˆ
- ç®¡ç†æ¸¸æˆçŠ¶æ€å’Œç©å®¶çŠ¶æ€

### åŒ¹é…å™¨ (MatchMaker)
- ç®¡ç†æ‰€æœ‰æ¸¸æˆçš„åŒ¹é…é˜Ÿåˆ—
- å®šæ—¶æ‰§è¡ŒåŒ¹é…ç®—æ³•
- ä¸ºç©å®¶å¯»æ‰¾åˆé€‚çš„å¯¹æ‰‹

---

## âœ¨ æ–°æ¶æ„ä¼˜åŠ¿

### 1. èŒè´£æ¸…æ™°
- æ¯ä¸ªæ¨¡å—åªè´Ÿè´£ä¸€ä¸ªæ˜ç¡®çš„åŠŸèƒ½
- ä»£ç ç»„ç»‡æ›´åˆç†
- æ˜“äºç†è§£å’Œç»´æŠ¤

### 2. é«˜åº¦å¯æ‰©å±•
- æ·»åŠ æ–°æ¸¸æˆåªéœ€ç»§æ‰¿åŸºç±»
- æ— éœ€ä¿®æ”¹æ ¸å¿ƒä»£ç 
- æ¸¸æˆä¹‹é—´å®Œå…¨éš”ç¦»

### 3. æ˜“äºæµ‹è¯•
- æ¯ä¸ªæ¨¡å—å¯ä»¥ç‹¬ç«‹æµ‹è¯•
- ä¾èµ–æ³¨å…¥ä½¿å¾— mock æ›´å®¹æ˜“
- å•å…ƒæµ‹è¯•æ›´ç®€å•

### 4. ä»£ç å¤ç”¨
- é€šç”¨é€»è¾‘åœ¨åŸºç±»ä¸­å®ç°
- æ¸¸æˆç‰¹å®šé€»è¾‘åœ¨å­ç±»ä¸­å®ç°
- å‡å°‘é‡å¤ä»£ç 

### 5. ç»Ÿä¸€ç®¡ç†
- æ‰€æœ‰æ¸¸æˆå…±äº«ä¸€ä¸ªåŒ¹é…å™¨
- ç»Ÿä¸€çš„æ¸¸æˆåŠ è½½æœºåˆ¶
- ç»Ÿä¸€çš„é”™è¯¯å¤„ç†

---

## ğŸ“– ä»£ç ç¤ºä¾‹

### å‘é€æ¸¸æˆå¼€å§‹æ¶ˆæ¯
```javascript
onGameStart() {
    this.players.forEach((player, index) => {
        this.sendToPlayer(player.socketId, 'game_start', {
            board: this.board,
            mySide: index === 0 ? 'a' : 'b',
            players: this.players.map(p => ({
                userId: p.userId,
                nickname: p.nickname
            }))
        });
    });
}
```

### å¤„ç†æ¸¸æˆç§»åŠ¨
```javascript
handleMove(socket, move) {
    // éªŒè¯å›åˆ
    const player = this.players.find(p => p.socketId === socket.id);
    if (!player) return;
    
    // éªŒè¯åˆæ³•æ€§
    if (!this.isValidMove(move)) {
        socket.emit('error', { message: 'éæ³•ç§»åŠ¨' });
        return;
    }
    
    // æ‰§è¡Œç§»åŠ¨
    this.applyMove(move);
    this.broadcast('move', { move });
    
    // æ£€æŸ¥èƒœè´Ÿ
    if (this.checkWin()) {
        this.handleWin(player.userId);
    }
}
```

---

## ğŸ”§ é…ç½®

### ç¯å¢ƒå˜é‡
```bash
PORT=5000                    # æœåŠ¡å™¨ç«¯å£
NODE_ENV=development         # ç¯å¢ƒ
SKIP_AUTH=false             # æ˜¯å¦è·³è¿‡é‰´æƒï¼ˆä»…æµ‹è¯•ç”¨ï¼‰
```

### æ¸¸æˆå®¤é…ç½®
```javascript
// åœ¨ GameManager.initTiers() ä¸­é…ç½®
this.createTier('free', 'å…è±†å®¤', 0, Infinity);
this.createTier('beginner', 'åˆçº§å®¤', 0, 1500);
this.createTier('intermediate', 'ä¸­çº§å®¤', 1500, 1800);
this.createTier('advanced', 'é«˜çº§å®¤', 1800, Infinity);
```

---

## ğŸ› æ•…éšœæ’æŸ¥

### æ¸¸æˆæ²¡æœ‰è‡ªåŠ¨åŠ è½½
```bash
# æ£€æŸ¥æ–‡ä»¶åæ˜¯å¦æ­£ç¡®
# å¿…é¡»æ˜¯ <GameName>Manager.js æˆ– index.js
ls server/src/games/mygame/
```

### åŒ¹é…ä¸æˆåŠŸ
```javascript
// æ£€æŸ¥åŒ¹é…å™¨æ˜¯å¦æ³¨å†Œ
console.log(matchMaker.handlers.has('mygame')); // åº”è¯¥æ˜¯ true
```

### ç©å®¶æ— æ³•åŠ å…¥æ¸¸æˆæ¡Œ
```javascript
// æ£€æŸ¥ç­‰çº§åˆ†é™åˆ¶
const tier = this.tiers.get('beginner');
console.log(tier.canAccess(playerRating)); // åº”è¯¥æ˜¯ true
```

---

## ğŸ“ è·å–å¸®åŠ©

### æ–‡æ¡£
- æŸ¥çœ‹ [å¿«é€Ÿå‚è€ƒæŒ‡å—](QUICK_REFERENCE.md) äº†è§£å¸¸è§ä»»åŠ¡
- æŸ¥çœ‹ [æ¶æ„è¯´æ˜](ARCHITECTURE.md) äº†è§£ç³»ç»Ÿè®¾è®¡
- æŸ¥çœ‹ [æ¨¡å—ç´¢å¼•](MODULE_INDEX.md) äº†è§£æ¨¡å—è¯¦æƒ…

### æ—¥å¿—
æ‰€æœ‰æ—¥å¿—éƒ½å¸¦æœ‰æ¨¡å—å‰ç¼€ï¼Œæ–¹ä¾¿å®šä½é—®é¢˜ï¼š
```
[SocketServer] ...
[GameLoader] ...
[GameManager] ...
[MatchMaker] ...
```

---

## ğŸ“ è´¡çŒ®æŒ‡å—

### ä»£ç è§„èŒƒ
1. ä½¿ç”¨ ES6 ç±»è¯­æ³•
2. æ‰€æœ‰æ³¨é‡Šä½¿ç”¨ä¸­æ–‡
3. éµå¾ªç°æœ‰çš„å‘½åè§„èŒƒ
4. æ·»åŠ è¯¦ç»†çš„æ–¹æ³•æ³¨é‡Š

### æäº¤è§„èŒƒ
```
feat: æ·»åŠ æ–°åŠŸèƒ½
fix: ä¿®å¤ bug
docs: æ›´æ–°æ–‡æ¡£
refactor: é‡æ„ä»£ç 
test: æ·»åŠ æµ‹è¯•
```

---

## ğŸ“… ç‰ˆæœ¬å†å²

### v2.0.0 (2025-11-30)
- âœ… å®Œæˆä»£ç è§£è€¦é‡æ„
- âœ… å¼•å…¥æ¨¡å—åŒ–æ¶æ„
- âœ… æ·»åŠ å®Œæ•´çš„ä¸­æ–‡æ³¨é‡Š
- âœ… åˆ›å»ºè¯¦ç»†çš„æ–‡æ¡£

### v1.0.0 (ä¹‹å‰)
- æ—§æ¶æ„ç‰ˆæœ¬

---

## ğŸ“„ è®¸å¯è¯

[æ ¹æ®é¡¹ç›®å®é™…æƒ…å†µå¡«å†™]

---

**æœ€åæ›´æ–°ï¼š** 2025-11-30  
**ç»´æŠ¤è€…ï¼š** HappyGames å¼€å‘å›¢é˜Ÿ  
**æ–‡æ¡£ç‰ˆæœ¬ï¼š** 2.0.0

---

## ğŸ¯ ä¸‹ä¸€æ­¥

1. é˜…è¯» [å¿«é€Ÿå‚è€ƒæŒ‡å—](QUICK_REFERENCE.md)
2. æŸ¥çœ‹ [æ¶æ„è¯´æ˜](ARCHITECTURE.md)
3. å°è¯•æ·»åŠ ä¸€ä¸ªæ–°æ¸¸æˆ
4. é˜…è¯» [æ¨¡å—ç´¢å¼•](MODULE_INDEX.md) æ·±å…¥äº†è§£

ç¥ä½ å¼€å‘æ„‰å¿«ï¼ğŸš€
